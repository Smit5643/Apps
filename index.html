<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover"/>
<meta name="theme-color" content="#0f0f0f"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="Suresh Millgin"/>
<meta name="mobile-web-app-capable" content="yes"/>
<meta name="application-name" content="Suresh Millgin Stores"/>
<meta name="description" content="Loom Machinery Spare Parts ‚Äî Suresh Millgin Stores"/>
<title>Suresh Millgin Stores</title>
<link rel="manifest" href="manifest.json"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
:root{
  --c:#0f0f0f;--c2:#161616;--c3:#1e1e1e;--c4:#272727;
  --g:#D4AF37;--gl:rgba(212,175,55,.13);--gb:rgba(212,175,55,.3);
  --s:#b0b0b0;--sb:rgba(176,176,176,.18);
  --t1:#ede8d8;--t2:#888070;
  --glass:rgba(255,255,255,.03);--glb:rgba(255,255,255,.07);
  --danger:#b03030;--ok:#1e7a46;
  --rad:10px;--rsm:6px;
  --sfb:env(safe-area-inset-bottom,0px);
}
html,body,#root{height:100%;width:100%;max-width:480px;margin:0 auto;background:var(--c);color:var(--t1);font-family:'Rajdhani',sans-serif;overflow-x:hidden}
::-webkit-scrollbar{display:none}
</style>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,400&family=Rajdhani:wght@400;500;600;700&family=Bebas+Neue&display=swap" rel="stylesheet"/>
</head>
<body>
<div id="root"></div>
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel" data-presets="react">
const { useState, useEffect, useRef, useMemo, useCallback } = React;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONSTANTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ADMIN_EMAIL = "smitbhatiya47@gmail.com";
const ADMIN_PASS  = "Smit_5643_@";
const KEY_SB      = "sms_sb_cfg";
const KEY_VH      = "sms_view_hist";
const KEY_NR      = "sms_notif_reads";

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOCAL STORAGE (real localStorage ‚Äî works in APK) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const LS = {
  set: async (k,v)=>{ try{ localStorage.setItem(k,JSON.stringify(v)); }catch(e){ console.warn("LS.set",e); } },
  get: async (k,fb=null)=>{ try{ const r=localStorage.getItem(k); return r!=null?JSON.parse(r):fb; }catch{ return fb; } },
  del: async (k)=>{ try{ localStorage.removeItem(k); }catch{} },
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SUPABASE REST API ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
class SB {
  constructor(url,key){
    this.base=url.replace(/\/$/,"");
    this.h={"apikey":key,"Authorization":"Bearer "+key,"Content-Type":"application/json","Prefer":"return=representation"};
  }
  async req(path,method="GET",body=null,extraH={}){
    const r=await fetch(this.base+"/rest/v1/"+path,{method,headers:{...this.h,...extraH},body:body?JSON.stringify(body):undefined});
    if(!r.ok){const e=await r.text();throw new Error(e);}
    const t=await r.text();return t?JSON.parse(t):null;
  }
  sel(tbl,filter="",order="created_at.desc"){let q=tbl+"?select=*&order="+order;if(filter)q+="&"+filter;return this.req(q);}
  ins(tbl,data){return this.req(tbl,"POST",Array.isArray(data)?data:[data]);}
  upd(tbl,id,data){return this.req(tbl+"?id=eq."+id,"PATCH",data);}
  del(tbl,id){return this.req(tbl+"?id=eq."+id,"DELETE");}
  delF(tbl,filter){return this.req(tbl+"?"+filter,"DELETE");}
  ups(tbl,data){return this.req(tbl,"POST",Array.isArray(data)?data:[data],{"Prefer":"resolution=merge-duplicates,return=representation"});}
  async uploadImg(bucket,name,blob){
    const r=await fetch(this.base+"/storage/v1/object/"+bucket+"/"+name,{method:"POST",headers:{"apikey":this.h.apikey,"Authorization":this.h.Authorization,"Content-Type":blob.type||"image/jpeg"},body:blob});
    if(!r.ok)throw new Error(await r.text());
    return this.base+"/storage/v1/object/public/"+bucket+"/"+name;
  }
}
let _sb=null;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DATA LAYER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DB={
  getCats:async()=>{ if(_sb)return(await _sb.sel("sms_categories","","sort_order.asc"))||[];return await LS.get("sms_cats",[]); },
  saveCat:async(c)=>{ if(_sb)return(await _sb.ups("sms_categories",c))?.[0];const a=await LS.get("sms_cats",[]);const i=a.findIndex(x=>x.id===c.id);if(i>=0)a[i]=c;else a.push(c);await LS.set("sms_cats",a);return c; },
  delCat:async(id)=>{ if(_sb){await _sb.del("sms_categories",id);await _sb.delF("sms_categories","parent_id=eq."+id);return;}const a=await LS.get("sms_cats",[]);await LS.set("sms_cats",a.filter(c=>c.id!==id&&c.parent_id!==id)); },
  getProds:async()=>{ if(_sb)return(await _sb.sel("sms_products"))||[];return await LS.get("sms_prods",[]); },
  saveProd:async(p)=>{ if(_sb)return(await _sb.ups("sms_products",p))?.[0];const a=await LS.get("sms_prods",[]);const i=a.findIndex(x=>x.id===p.id);if(i>=0)a[i]=p;else a.push(p);await LS.set("sms_prods",a);return p; },
  delProd:async(id)=>{ if(_sb)return _sb.del("sms_products",id);const a=await LS.get("sms_prods",[]);await LS.set("sms_prods",a.filter(p=>p.id!==id)); },
  getChats:async()=>{ if(_sb)return(await _sb.sel("sms_chats","","sent_at.asc"))||[];return await LS.get("sms_chats",[]); },
  addChat:async(m)=>{ if(_sb)return _sb.ins("sms_chats",m);const a=await LS.get("sms_chats",[]);await LS.set("sms_chats",[...a,m]); },
  unlockChat:async(email)=>{ if(_sb){const rows=(await _sb.sel("sms_chats","user_email=eq."+encodeURIComponent(email)))||[];await Promise.all(rows.map(r=>_sb.upd("sms_chats",r.id,{locked:false})));return;}const a=await LS.get("sms_chats",[]);await LS.set("sms_chats",a.map(m=>m.user_email===email?{...m,locked:false}:m)); },
  addAudit:async(e)=>{ if(_sb)return _sb.ins("sms_audit",e).catch(()=>{});const a=await LS.get("sms_audit",[]);await LS.set("sms_audit",[e,...a].slice(0,500)); },
  getAudit:async()=>{ if(_sb)return(await _sb.sel("sms_audit","","logged_at.desc"))||[];return await LS.get("sms_audit",[]); },
  addView:async(e)=>{ if(_sb)return _sb.ins("sms_view_hist",e).catch(()=>{});const a=await LS.get(KEY_VH,[]);await LS.set(KEY_VH,[e,...a].slice(0,2000)); },
  getUserViews:async(email)=>{ if(_sb)return(await _sb.sel("sms_view_hist","user_email=eq."+encodeURIComponent(email),"viewed_at.desc"))||[];const a=await LS.get(KEY_VH,[]);return a.filter(v=>v.user_email===email); },
  getAllViews:async()=>{ if(_sb)return(await _sb.sel("sms_view_hist","","viewed_at.desc"))||[];return await LS.get(KEY_VH,[]); },
  getNotifs:async()=>{ if(_sb)return(await _sb.sel("sms_notifs"))||[];return await LS.get("sms_notifs",[]); },
  addNotif:async(n)=>{ if(_sb)return _sb.ins("sms_notifs",n);const a=await LS.get("sms_notifs",[]);await LS.set("sms_notifs",[n,...a]); },
  delNotif:async(id)=>{ if(_sb)return _sb.del("sms_notifs",id);const a=await LS.get("sms_notifs",[]);await LS.set("sms_notifs",a.filter(n=>n.id!==id)); },
  markRead:async(nid,email)=>{ if(_sb)return _sb.ups("sms_notif_reads",{id:nid+"_"+email,notif_id:nid,user_email:email}).catch(()=>{});const a=await LS.get(KEY_NR,[]);if(!a.find(r=>r.nid===nid&&r.email===email))await LS.set(KEY_NR,[...a,{nid,email}]); },
  getReads:async(email)=>{ if(_sb){const r=(await _sb.sel("sms_notif_reads","user_email=eq."+encodeURIComponent(email)))||[];return r.map(x=>x.notif_id);}const a=await LS.get(KEY_NR,[]);return a.filter(r=>r.email===email).map(r=>r.nid); },
  uploadImg:async(file,folder="products")=>{ if(_sb){const name=folder+"/"+Date.now()+"_"+Math.random().toString(36).slice(2)+".jpg";const blob=await toBlob(file);return _sb.uploadImg("sms-images",name,blob);}return toBase64(file); },
  uploadVideo:async(file)=>{
    if(_sb){const ext=(file.name||"video.mp4").split(".").pop()||"mp4";const name="videos/"+Date.now()+"_"+Math.random().toString(36).slice(2)+"."+ext;const r=await fetch(_sb.base+"/storage/v1/object/sms-images/"+name,{method:"POST",headers:{"apikey":_sb.h.apikey,"Authorization":_sb.h.Authorization,"Content-Type":file.type||"video/mp4"},body:file});if(!r.ok)throw new Error(await r.text());return _sb.base+"/storage/v1/object/public/sms-images/"+name;}
    return new Promise((res,rej)=>{const rd=new FileReader();rd.onload=e=>res(e.target.result);rd.onerror=rej;rd.readAsDataURL(file);});
  },
  bulkDeleteChats:async(before)=>{ if(_sb)return _sb.delF("sms_chats","sent_at=lt."+before);const a=await LS.get("sms_chats",[]);await LS.set("sms_chats",a.filter(m=>(m.sent_at||"")>=before)); },
  bulkDeleteAudit:async(before)=>{ if(_sb)return _sb.delF("sms_audit","logged_at=lt."+before);const a=await LS.get("sms_audit",[]);await LS.set("sms_audit",a.filter(m=>(m.logged_at||"")>=before)); },
  bulkDeleteViews:async(before)=>{ if(_sb)return _sb.delF("sms_view_hist","viewed_at=lt."+before);const a=await LS.get(KEY_VH,[]);await LS.set(KEY_VH,a.filter(v=>(v.viewed_at||"")>=before)); },
  bulkDeleteNotifReads:async()=>{ if(_sb)return _sb.delF("sms_notif_reads","id=neq.xxx").catch(()=>{});await LS.set(KEY_NR,[]); },
  bulkDeleteNotifs:async(before)=>{ if(_sb)return _sb.delF("sms_notifs","created_at=lt."+before);const a=await LS.get("sms_notifs",[]);await LS.set("sms_notifs",a.filter(n=>(n.created_at||"")>=before)); },
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UTILS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const uid=()=>Date.now().toString(36)+Math.random().toString(36).slice(2);
const nowIST=()=>new Date().toLocaleString("en-IN",{timeZone:"Asia/Kolkata",hour12:false});
const genOTP=()=>Math.floor(100000+Math.random()*900000).toString();
const getIP=async()=>{ try{const r=await fetch("https://api.ipify.org?format=json");return(await r.json()).ip;}catch{return "unknown";} };
function toBlob(file,maxW=900){return new Promise((res,rej)=>{const rd=new FileReader();rd.onload=e=>{const img=new Image();img.onload=()=>{const c=document.createElement("canvas");const r=Math.min(1,maxW/img.width);c.width=Math.round(img.width*r);c.height=Math.round(img.height*r);c.getContext("2d").drawImage(img,0,0,c.width,c.height);c.toBlob(res,"image/jpeg",.82);};img.onerror=rej;img.src=e.target.result;};rd.onerror=rej;rd.readAsDataURL(file);});}
function toBase64(file,maxW=900){return new Promise((res,rej)=>{const rd=new FileReader();rd.onload=e=>{const img=new Image();img.onload=()=>{const c=document.createElement("canvas");const r=Math.min(1,maxW/img.width);c.width=Math.round(img.width*r);c.height=Math.round(img.height*r);c.getContext("2d").drawImage(img,0,0,c.width,c.height);res(c.toDataURL("image/jpeg",.82));};img.onerror=rej;img.src=e.target.result;};rd.onerror=rej;rd.readAsDataURL(file);});}
async function loadSBConfig(){const cfg=await LS.get(KEY_SB);if(cfg?.url&&cfg?.key){_sb=new SB(cfg.url,cfg.key);return cfg;}return null;}
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CSS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CSS=`
body::before{content:'';position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.4;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.02'/%3E%3C/svg%3E")}
.root{min-height:100vh;position:relative;z-index:1;display:flex;flex-direction:column}
.ldr{position:fixed;inset:0;z-index:9999;background:var(--c);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:24px}
.gw{width:88px;height:88px;position:relative;display:flex;align-items:center;justify-content:center}
.go{animation:gs 2.2s linear infinite;transform-origin:center}
.gi{animation:gi2 1.5s linear infinite;transform-origin:center;position:absolute}
@keyframes gs{from{transform:rotate(0)}to{transform:rotate(360deg)}}
@keyframes gi2{from{transform:rotate(0)}to{transform:rotate(-360deg)}}
.lt{font-family:'Cormorant Garamond',serif;font-size:10px;letter-spacing:6px;color:var(--g);text-transform:uppercase;animation:blk 1.3s ease-in-out infinite}
@keyframes blk{0%,100%{opacity:.2}50%{opacity:1}}
.lb{width:140px;height:1px;background:var(--c4);overflow:hidden;position:relative}
.lb::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,var(--g),transparent);animation:bs 1.3s ease-in-out infinite}
@keyframes bs{from{left:-100%}to{left:100%}}
.page{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-bottom:calc(74px + var(--sfb))}
.hdr{position:sticky;top:0;z-index:200;background:rgba(15,15,15,.96);backdrop-filter:blur(18px);border-bottom:1px solid var(--glb);padding:0 16px;height:54px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.hdr-title{font-family:'Bebas Neue',sans-serif;font-size:17px;color:var(--g);letter-spacing:3px}
.hbk{background:none;border:none;color:var(--g);font-size:22px;cursor:pointer;padding:4px 8px 4px 0;line-height:1}
.bnav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;z-index:300;background:rgba(15,15,15,.97);border-top:1px solid var(--glb);display:flex;padding-bottom:var(--sfb)}
.bn{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:9px 2px;cursor:pointer;gap:2px;position:relative}
.bn-i{font-size:18px;transition:transform .2s}.bn-l{font-size:8px;letter-spacing:1px;text-transform:uppercase;color:var(--t2);font-weight:600}
.bn.on .bn-l{color:var(--g)}.bn.on .bn-i{transform:scale(1.15)}
.bn-badge{position:absolute;top:5px;right:calc(50% - 18px);background:var(--danger);color:#fff;font-size:7px;font-weight:700;width:14px;height:14px;border-radius:50%;display:flex;align-items:center;justify-content:center}
.gc{background:var(--glass);border:1px solid var(--glb);border-radius:var(--rad);backdrop-filter:blur(16px)}
.ctl,.cbr{position:absolute;width:13px;height:13px}
.ctl{top:-1px;left:-1px;border-top:2px solid var(--g);border-left:2px solid var(--g);border-radius:2px 0 0 0}
.cbr{bottom:-1px;right:-1px;border-bottom:2px solid var(--g);border-right:2px solid var(--g);border-radius:0 0 2px 0}
.splash{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:26px 18px;overflow-y:auto}
.sp-brand{font-family:'Bebas Neue',sans-serif;font-size:36px;color:var(--g);letter-spacing:5px;text-align:center;line-height:1}
.sp-sub{font-family:'Cormorant Garamond',serif;font-size:11px;color:var(--s);letter-spacing:3px;text-align:center;margin-top:5px}
.gold-line{width:55px;height:1px;background:linear-gradient(90deg,transparent,var(--g),transparent);margin:11px auto}
.policy-box{font-size:11px;line-height:1.8;color:var(--t2);max-height:210px;overflow-y:auto;padding:14px;border:1px solid var(--glb);border-radius:var(--rsm);margin:14px 0;background:rgba(0,0,0,.3)}
.policy-box h4{color:var(--s);font-size:9px;letter-spacing:2px;margin:12px 0 4px;text-transform:uppercase}
.scroll-hint{font-size:10px;color:var(--g);letter-spacing:1px;text-align:center;margin-bottom:8px;animation:blk 1.5s ease-in-out infinite}
.btn{width:100%;padding:13px;border:none;cursor:pointer;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:12px;letter-spacing:3px;text-transform:uppercase;border-radius:var(--rsm);transition:all .2s}
.btn-g{background:linear-gradient(135deg,var(--g),#b8960c);color:#0f0f0f}
.btn-g:active{transform:scale(.97)}.btn-g:disabled{opacity:.35;cursor:not-allowed;transform:none}
.btn-ol{background:transparent;color:var(--s);border:1px solid var(--sb);margin-top:9px}
.btn-ol:active{border-color:var(--gb);color:var(--g)}
.btn-danger{background:var(--danger);color:#fff;border:none}
.btn-ok{background:var(--ok);color:#fff;border:none}
.btn-sm{padding:7px 11px;width:auto;font-size:10px;letter-spacing:1.5px;border-radius:var(--rsm)}
.ig{margin-bottom:12px}
.il{display:block;font-size:9px;letter-spacing:3px;color:var(--g);text-transform:uppercase;margin-bottom:5px;font-weight:600}
.inp{width:100%;background:rgba(0,0,0,.5);border:1px solid var(--glb);color:var(--t1);font-family:'Rajdhani',sans-serif;font-size:14px;padding:12px 13px;outline:none;border-radius:var(--rsm);transition:border-color .2s;-webkit-appearance:none}
.inp:focus{border-color:var(--gb)}.inp::placeholder{color:var(--t2)}
.iw{position:relative}.iw .inp{padding-right:42px}
.ieye{position:absolute;right:11px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--t2);cursor:pointer;font-size:15px}
.ta{width:100%;background:rgba(0,0,0,.4);border:1px solid var(--glb);color:var(--t1);font-family:'Rajdhani',sans-serif;font-size:14px;padding:11px 13px;outline:none;resize:vertical;min-height:80px;border-radius:var(--rsm)}
.ta:focus{border-color:var(--gb)}
select.inp{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='11' viewBox='0 0 24 24' fill='%23888070'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;-webkit-appearance:none}
select.inp option{background:var(--c2);color:var(--t1)}
.err-box{color:#e05555;font-size:11px;padding:9px 12px;background:rgba(224,85,85,.08);border:1px solid rgba(224,85,85,.2);border-radius:var(--rsm);margin-bottom:11px;text-align:center}
.ok-box{color:#3ecf7a;font-size:11px;padding:9px 12px;background:rgba(62,207,122,.08);border:1px solid rgba(62,207,122,.22);border-radius:var(--rsm);margin-bottom:11px;text-align:center}
.otp-box{width:43px;height:50px;background:rgba(0,0,0,.5);border:1px solid var(--glb);color:var(--t1);font-family:'Bebas Neue',sans-serif;font-size:22px;text-align:center;outline:none;border-radius:var(--rsm);transition:border-color .2s}
.otp-box:focus{border-color:var(--g)}
.tog{display:flex;align-items:center;gap:9px;cursor:pointer;padding:3px 0}
.tog-t{width:38px;height:21px;background:var(--c4);border-radius:11px;position:relative;transition:background .2s;border:1px solid var(--glb);flex-shrink:0}
.tog-t.on{background:var(--g)}.tog-th{position:absolute;top:2px;left:2px;width:15px;height:15px;background:#fff;border-radius:50%;transition:left .2s;box-shadow:0 1px 3px rgba(0,0,0,.3)}
.tog-t.on .tog-th{left:19px}.tog-l{font-size:11px;color:var(--t2)}
.chk-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:5px}
.chk-item{display:flex;align-items:center;gap:5px;padding:5px 10px;border:1px solid var(--glb);border-radius:12px;cursor:pointer;transition:all .2s;font-size:11px;color:var(--t2)}
.chk-item.on{border-color:var(--gb);background:var(--gl);color:var(--g)}
.chk-box{width:13px;height:13px;border:1.5px solid currentColor;border-radius:3px;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:8px}
.home-hero{padding:20px 16px 15px;border-bottom:1px solid var(--glb)}
.hero-brand{font-family:'Bebas Neue',sans-serif;font-size:25px;color:var(--g);letter-spacing:3px;line-height:1}
.hero-tag{font-family:'Cormorant Garamond',serif;font-size:12px;color:var(--s);font-style:italic;margin-top:3px}
.hero-est{font-size:9px;color:var(--t2);letter-spacing:3px;margin-top:2px}
.sechd{padding:14px 16px 7px;display:flex;align-items:center;justify-content:space-between}
.sectit{font-size:10px;color:var(--g);letter-spacing:3px;text-transform:uppercase;font-weight:700}
.secct{font-size:10px;color:var(--t2)}
.cat-row{display:flex;gap:9px;overflow-x:auto;padding:3px 16px 12px;scrollbar-width:none}
.cat-card{flex-shrink:0;width:92px;cursor:pointer;border-radius:var(--rsm);overflow:hidden;border:1.5px solid var(--glb);transition:all .2s;background:var(--c3)}
.cat-card.on{border-color:var(--g)}.cat-card:active{transform:scale(.96)}
.cat-thumb{width:100%;height:74px;object-fit:cover;display:block}
.cat-ph{width:100%;height:74px;display:flex;align-items:center;justify-content:center;font-size:24px;background:var(--c3)}
.cat-lbl{padding:5px 7px 6px;background:var(--c2)}
.cat-lbl-name{font-size:10px;font-weight:700;color:var(--t1);text-align:center;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cat-lbl-ct{font-size:8px;color:var(--t2);text-align:center;margin-top:1px}
.sub-row{display:flex;gap:6px;overflow-x:auto;padding:3px 16px 9px;scrollbar-width:none}
.sub-chip{flex-shrink:0;padding:5px 11px;background:var(--glass);border:1px solid var(--glb);border-radius:14px;font-size:10px;font-weight:600;color:var(--t2);cursor:pointer;transition:all .2s;white-space:nowrap}
.sub-chip.on{background:var(--gl);border-color:var(--gb);color:var(--g)}
.prod-list{display:flex;flex-direction:column;gap:1px;background:var(--glb)}
.prod-row{background:var(--c);display:flex;align-items:center;gap:11px;padding:11px 16px;cursor:pointer;transition:background .15s}
.prod-row:active{background:var(--c3)}
.pthumb{width:58px;height:58px;border-radius:var(--rsm);overflow:hidden;flex-shrink:0;background:var(--c3);border:1px solid var(--glb);display:flex;align-items:center;justify-content:center;font-size:22px}
.pthumb img{width:100%;height:100%;object-fit:cover;display:block}
.pbody{flex:1;min-width:0}
.pcat{font-size:8px;color:var(--g);letter-spacing:2px;text-transform:uppercase;margin-bottom:2px}
.pname{font-family:'Cormorant Garamond',serif;font-size:14px;color:var(--t1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pprice{font-size:11px;font-weight:700;color:var(--g);margin-top:2px}
.pprice.na{font-family:'Cormorant Garamond',serif;font-style:italic;color:var(--s)}
.pd{position:fixed;inset:0;z-index:500;background:var(--c);display:flex;flex-direction:column;animation:sli .25s ease;max-width:480px;margin:0 auto}
@keyframes sli{from{transform:translateX(100%)}to{transform:translateX(0)}}
.pd-scr{flex:1;overflow-y:auto;padding-bottom:calc(80px + var(--sfb))}
.crl{position:relative;width:100%;background:var(--c3);border-bottom:1px solid var(--glb)}
.crl-track{display:flex;overflow-x:auto;scroll-snap-type:x mandatory;scrollbar-width:none}
.crl-track::-webkit-scrollbar{display:none}
.crl-slide{flex:0 0 100%;scroll-snap-align:start;height:250px;display:flex;align-items:center;justify-content:center;background:var(--c3);overflow:hidden}
.crl-slide img{width:100%;height:100%;object-fit:contain}
.crl-dots{position:absolute;bottom:8px;left:0;right:0;display:flex;justify-content:center;gap:4px;pointer-events:none}
.cdot{width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,.3);transition:all .2s}
.cdot.on{background:var(--g);width:16px;border-radius:3px}
.crl-thumbs{display:flex;gap:5px;overflow-x:auto;padding:8px 13px;background:var(--c2);border-bottom:1px solid var(--glb);scrollbar-width:none}
.crl-tb{flex-shrink:0;width:46px;height:46px;border-radius:5px;overflow:hidden;border:2px solid var(--glb);cursor:pointer;transition:border-color .2s;background:var(--c3)}
.crl-tb.on{border-color:var(--g)}.crl-tb img{width:100%;height:100%;object-fit:cover;display:block}
.pd-info{padding:14px 16px}
.pd-cat{font-size:9px;color:var(--g);letter-spacing:3px;text-transform:uppercase;margin-bottom:5px}
.pd-name{font-family:'Cormorant Garamond',serif;font-size:23px;color:var(--t1);margin-bottom:8px;line-height:1.2}
.pd-price{font-family:'Bebas Neue',sans-serif;font-size:24px;color:var(--g);letter-spacing:3px;margin-bottom:13px}
.pd-price.na{font-family:'Cormorant Garamond',serif;font-size:15px;font-style:italic;color:var(--s)}
.pd-hr{width:100%;height:1px;background:var(--glb);margin-bottom:13px}
.pd-desc{font-size:13px;line-height:1.8;color:var(--t2)}
.pd-acts{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;background:rgba(15,15,15,.97);border-top:1px solid var(--glb);padding:11px 16px;padding-bottom:calc(11px + var(--sfb));display:flex;gap:9px}
.srch{padding:9px 16px}
.srch-in{position:relative}
.srch-in::before{content:'üîç';position:absolute;left:12px;top:50%;transform:translateY(-50%);font-size:13px;pointer-events:none}
.srch-inp{width:100%;background:var(--c3);border:1px solid var(--glb);color:var(--t1);font-family:'Rajdhani',sans-serif;font-size:14px;padding:10px 13px 10px 34px;outline:none;border-radius:17px;transition:border-color .2s}
.srch-inp:focus{border-color:var(--gb)}.srch-inp::placeholder{color:var(--t2)}
.rec-row{display:flex;gap:9px;overflow-x:auto;padding:3px 16px 12px;scrollbar-width:none}
.rec-card{flex-shrink:0;width:125px;background:var(--glass);border:1px solid var(--glb);border-radius:var(--rsm);overflow:hidden;cursor:pointer;transition:all .2s}
.rec-card:active{transform:scale(.96)}.rec-card:hover{border-color:var(--gb)}
.rec-img{height:95px;background:var(--c3);display:flex;align-items:center;justify-content:center;font-size:30px;overflow:hidden}
.rec-img img{width:100%;height:100%;object-fit:cover;display:block}
.rec-body{padding:7px 8px 9px}
.rec-name{font-size:11px;color:var(--t1);font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px}
.rec-price{font-size:11px;color:var(--g);font-weight:700}
.rec-price.na{font-family:'Cormorant Garamond',serif;font-style:italic;color:var(--s)}
.chat-msgs{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:10px;padding-bottom:calc(76px + var(--sfb))}
.cm{display:flex;flex-direction:column;gap:3px}.cm.u{align-items:flex-end}
.cb{max-width:82%;padding:9px 12px;font-size:13px;line-height:1.5;border-radius:11px}
.cb.u{background:var(--gl);border:1px solid var(--gb);color:var(--t1);border-radius:11px 11px 3px 11px}
.cb.a{background:var(--c3);border:1px solid var(--glb);color:var(--t1);border-radius:11px 11px 11px 3px}
.cts{font-size:9px;color:var(--t2)}
.chat-locked{margin:13px;padding:13px;border:1px solid var(--gb);background:var(--gl);border-radius:var(--rad);text-align:center}
.chat-locked-t{font-family:'Cormorant Garamond',serif;font-size:13px;color:var(--g);font-style:italic}
.chat-bar{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;background:rgba(15,15,15,.97);border-top:1px solid var(--glb);padding:8px 10px;padding-bottom:calc(8px + var(--sfb));display:flex;gap:6px;align-items:flex-end}
.chat-inp{flex:1;background:var(--c3);border:1px solid var(--glb);color:var(--t1);font-family:'Rajdhani',sans-serif;font-size:14px;padding:10px 12px;outline:none;border-radius:17px;resize:none;max-height:90px;transition:border-color .2s}
.chat-inp:focus{border-color:var(--gb)}
.chat-send{width:38px;height:38px;background:var(--g);border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0}
.chat-mic{width:38px;height:38px;background:var(--c4);border:1.5px solid var(--glb);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:17px;flex-shrink:0;transition:all .2s}
.chat-mic.recording{background:var(--danger);border-color:var(--danger);animation:pulse-rec .8s ease-in-out infinite}
@keyframes pulse-rec{0%,100%{box-shadow:0 0 0 0 rgba(176,48,48,.5)}50%{box-shadow:0 0 0 8px rgba(176,48,48,0)}}
.rec-bar{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;background:rgba(15,15,15,.97);border-top:1px solid var(--danger);padding:10px 16px;padding-bottom:calc(10px + var(--sfb));display:flex;align-items:center;gap:12px;z-index:400}
.rec-dot{width:10px;height:10px;border-radius:50%;background:var(--danger);animation:pulse-rec .8s ease-in-out infinite;flex-shrink:0}
.rec-timer{font-family:'Bebas Neue',sans-serif;font-size:20px;color:var(--danger);letter-spacing:2px;width:50px}
.rec-waves{flex:1;display:flex;align-items:center;gap:2px;height:28px;overflow:hidden}
.rec-wave-bar{flex:1;background:var(--danger);border-radius:1px;min-height:3px;transition:height .1s ease;opacity:.7}
.rec-cancel{background:none;border:1px solid var(--glb);color:var(--t2);width:32px;height:32px;border-radius:50%;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.rec-send{width:38px;height:38px;background:var(--g);border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.vn-bubble{display:flex;align-items:center;gap:9px;padding:9px 12px;border-radius:11px;min-width:180px;max-width:260px;cursor:pointer}
.vn-bubble.u{background:var(--gl);border:1px solid var(--gb);border-radius:11px 11px 3px 11px}
.vn-bubble.a{background:var(--c3);border:1px solid var(--glb);border-radius:11px 11px 11px 3px}
.vn-play{width:34px;height:34px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0}
.vn-bubble.u .vn-play{background:rgba(212,175,55,.3);color:var(--g)}
.vn-bubble.a .vn-play{background:rgba(255,255,255,.1);color:var(--t1)}
.vn-waveform{flex:1;display:flex;align-items:center;gap:2px;height:28px}
.vn-bar{border-radius:1px;flex-shrink:0;width:3px}
.vn-bubble.u .vn-bar{background:rgba(212,175,55,.35)}
.vn-bubble.u .vn-bar.played{background:var(--g)}
.vn-bubble.a .vn-bar{background:rgba(255,255,255,.18)}
.vn-bubble.a .vn-bar.played{background:var(--s)}
.vn-dur{font-size:10px;font-weight:700;flex-shrink:0;min-width:30px;text-align:right}
.vn-bubble.u .vn-dur{color:var(--g)}.vn-bubble.a .vn-dur{color:var(--t2)}
.prof-card{margin:14px;padding:18px;border-radius:var(--rad);position:relative}
.prof-av{width:50px;height:50px;background:var(--gl);border:2px solid var(--gb);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:10px}
.prof-name{font-family:'Cormorant Garamond',serif;font-size:20px;color:var(--t1);margin-bottom:2px}
.prof-row{display:flex;align-items:center;gap:11px;padding:13px 16px;border-bottom:1px solid var(--glb);cursor:pointer}
.prof-row:active{background:var(--c3)}.prof-row-lbl{font-size:13px;color:var(--t1);font-weight:600;flex:1}
.notif-banner{margin:10px 16px 0;padding:11px 13px;border-radius:var(--rsm);border:1px solid var(--gb);background:var(--gl);cursor:pointer}
.notif-banner-title{font-size:12px;font-weight:700;color:var(--g);margin-bottom:2px}
.notif-banner-msg{font-size:11px;color:var(--t2);line-height:1.5}
.notif-item{padding:13px 16px;border-bottom:1px solid var(--glb);display:flex;gap:9px}
.ndot{width:7px;height:7px;background:var(--g);border-radius:50%;flex-shrink:0;margin-top:4px}
.ndot.read{background:var(--t2)}
.ntit{font-size:13px;font-weight:700;color:var(--t1);margin-bottom:2px}
.nmsg{font-size:12px;color:var(--t2);line-height:1.5}
.nts{font-size:9px;color:var(--t2);margin-top:3px}
.adm-tabs{display:flex;overflow-x:auto;border-bottom:1px solid var(--glb);background:var(--c2);scrollbar-width:none;flex-shrink:0}
.at{flex-shrink:0;padding:11px 10px;font-size:8px;letter-spacing:1.5px;text-transform:uppercase;color:var(--t2);border-bottom:2px solid transparent;cursor:pointer;font-weight:600;white-space:nowrap}
.at.on{color:var(--g);border-bottom-color:var(--g)}
.adm-body{padding:13px;padding-bottom:calc(24px + var(--sfb));overflow-y:auto;flex:1}
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:13px}
.stat-box{background:var(--c3);border:1px solid var(--glb);border-radius:var(--rsm);padding:13px;position:relative;overflow:hidden}
.stat-box::after{content:'';position:absolute;right:0;top:0;width:3px;height:100%;background:var(--g)}
.stat-n{font-family:'Bebas Neue',sans-serif;font-size:28px;color:var(--g);letter-spacing:2px;line-height:1}
.stat-l{font-size:9px;color:var(--t2);letter-spacing:2px;text-transform:uppercase;margin-top:3px}
.form-card{background:var(--c3);border:1px solid var(--glb);border-radius:var(--rad);padding:15px;margin-bottom:12px}
.form-title{font-size:9px;color:var(--g);letter-spacing:3px;text-transform:uppercase;margin-bottom:13px;font-weight:700}
.tbl-wrap{background:var(--c3);border:1px solid var(--glb);border-radius:var(--rsm);overflow:hidden;margin-bottom:11px}
.chart-card{background:var(--c3);border:1px solid var(--glb);border-radius:var(--rsm);padding:13px;margin-bottom:11px}
.chart-title{font-size:9px;letter-spacing:3px;color:var(--g);text-transform:uppercase;margin-bottom:11px;font-weight:700}
.bar-ch{display:flex;align-items:flex-end;gap:5px;height:105px}
.bc-i{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;height:100%;justify-content:flex-end}
.bc-v{font-size:9px;color:var(--g);font-family:'Bebas Neue',sans-serif}
.bc-b{width:100%;background:linear-gradient(180deg,var(--g),var(--gl));border-radius:2px 2px 0 0;min-height:3px;transition:height .5s}
.bc-l{font-size:7px;color:var(--t2);text-align:center}
.pill{font-size:8px;padding:2px 7px;letter-spacing:1px;text-transform:uppercase;border-radius:9px}
.pill-g{background:rgba(30,122,70,.2);color:#3ecf7a;border:1px solid rgba(62,207,122,.25)}
.pill-y{background:rgba(212,175,55,.1);color:var(--g);border:1px solid var(--gb)}
.pill-r{background:rgba(176,48,48,.2);color:#e05555;border:1px solid rgba(224,85,85,.25)}
.img-zone{border:2px dashed var(--glb);border-radius:var(--rsm);padding:16px;text-align:center;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.img-zone:active,.img-zone:hover{border-color:var(--gb)}
.img-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;font-size:0}
.thumb-prev{width:100%;height:105px;border-radius:var(--rsm);overflow:hidden;margin-bottom:9px;border:1px solid var(--glb);position:relative}
.thumb-prev img{width:100%;height:100%;object-fit:cover;display:block}
.thumb-rm{position:absolute;top:5px;right:5px;background:rgba(0,0,0,.8);border:none;color:#fff;width:22px;height:22px;border-radius:50%;cursor:pointer;font-size:11px;display:flex;align-items:center;justify-content:center}
.img-grid{display:flex;gap:7px;flex-wrap:wrap;margin-bottom:9px}
.img-item{width:72px;height:72px;border-radius:var(--rsm);overflow:hidden;border:1.5px solid var(--glb);position:relative;background:var(--c3)}
.img-item img{width:100%;height:100%;object-fit:cover;display:block}
.img-rm{position:absolute;top:2px;right:2px;background:rgba(0,0,0,.8);border:none;color:#fff;width:17px;height:17px;border-radius:50%;cursor:pointer;font-size:9px;display:flex;align-items:center;justify-content:center}
.img-mb{position:absolute;bottom:2px;left:2px;background:var(--g);color:#0f0f0f;font-size:6px;font-weight:700;padding:1px 3px;border-radius:2px}
.img-add{width:72px;height:72px;border:2px dashed var(--glb);border-radius:var(--rsm);display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--t2);cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.img-add:active{border-color:var(--gb);color:var(--g)}.img-add input{position:absolute;inset:0;opacity:0;cursor:pointer;font-size:0}
.vid-prev{width:100%;border-radius:var(--rsm);overflow:hidden;margin-bottom:9px;border:1px solid var(--glb);position:relative;background:#000}
.vid-prev video{width:100%;max-height:180px;display:block;object-fit:contain}
.vid-prev-rm{position:absolute;top:6px;right:6px;background:rgba(0,0,0,.85);border:none;color:#fff;width:24px;height:24px;border-radius:50%;cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center;z-index:2}
.vid-badge{position:absolute;top:6px;left:6px;background:rgba(0,0,0,.75);color:var(--g);font-size:8px;font-weight:700;padding:2px 7px;border-radius:3px;letter-spacing:1px}
.vid-player{width:100%;border-radius:var(--rsm);overflow:hidden;border:1px solid var(--glb);background:#000;margin-bottom:14px}
.vid-player video{width:100%;max-height:260px;display:block;object-fit:contain}
.vid-zone{border:2px dashed rgba(212,175,55,.3);border-radius:var(--rsm);padding:16px;text-align:center;cursor:pointer;transition:all .2s;position:relative;overflow:hidden;background:rgba(212,175,55,.03)}
.vid-zone:active,.vid-zone:hover{border-color:var(--gb)}
.vid-zone input{position:absolute;inset:0;opacity:0;cursor:pointer;font-size:0}
.irow{display:flex;align-items:center;gap:9px;padding:10px 13px;border-bottom:1px solid var(--glb);background:var(--c3)}
.irow:last-child{border-bottom:none}
.ithumb{width:40px;height:40px;border-radius:5px;overflow:hidden;border:1px solid var(--glb);background:var(--c2);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.ithumb img{width:100%;height:100%;object-fit:cover;display:block}
.iinfo{flex:1;min-width:0}
.iname{font-size:12px;color:var(--t1);font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.isub{font-size:9px;color:var(--t2);margin-top:1px}
.iacts{display:flex;gap:5px;flex-shrink:0;align-items:center}
.edit-card{background:var(--c2);border:1px solid var(--gb);border-radius:var(--rsm);padding:13px;margin-bottom:9px}
.edit-title{font-size:9px;color:var(--g);letter-spacing:3px;text-transform:uppercase;margin-bottom:11px;font-weight:700}
.act-row{padding:10px 13px;border-bottom:1px solid var(--glb)}
.act-row:last-child{border-bottom:none}
.act-meta{display:flex;justify-content:space-between;align-items:flex-start;gap:8px;margin-bottom:2px}
.act-name{font-size:11px;color:var(--t1);font-weight:600}
.act-time{font-size:9px;color:var(--g);flex-shrink:0}
.act-ip{font-size:9px;color:var(--t2);font-family:monospace}
.sb-schema{background:rgba(0,0,0,.5);border:1px solid var(--glb);border-radius:var(--rsm);padding:11px;font-family:monospace;font-size:8px;color:var(--t2);line-height:1.6;max-height:200px;overflow-y:auto;white-space:pre;margin-bottom:13px}
.sec-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--glb)}
.sec-row:last-child{border-bottom:none}
.sl{font-size:12px;color:var(--t2);flex:1;padding-right:8px}.sv{font-size:10px;color:var(--g);text-align:right}
.cl-section{background:var(--c3);border:1px solid var(--glb);border-radius:var(--rad);padding:15px;margin-bottom:12px}
.cl-title{font-size:9px;color:var(--g);letter-spacing:3px;text-transform:uppercase;margin-bottom:13px;font-weight:700;display:flex;align-items:center;gap:7px}
.cl-item{display:flex;align-items:center;gap:11px;padding:11px 0;border-bottom:1px solid var(--glb);cursor:pointer}
.cl-item:last-child{border-bottom:none}
.cl-chk{width:18px;height:18px;border:2px solid var(--glb);border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0;transition:all .2s}
.cl-chk.on{background:var(--g);border-color:var(--g);color:#0f0f0f}
.cl-label{flex:1}
.cl-label-name{font-size:12px;color:var(--t1);font-weight:600}
.cl-label-sub{font-size:9px;color:var(--t2);margin-top:1px}
.cl-count{font-family:'Bebas Neue',sans-serif;font-size:18px;color:var(--g)}
.cl-confirm{background:rgba(176,48,48,.12);border:1px solid rgba(176,48,48,.3);border-radius:var(--rsm);padding:13px;margin-bottom:12px}
.progress-bar{width:100%;height:6px;background:var(--c4);border-radius:3px;overflow:hidden;margin-top:8px}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--g),#b8960c);border-radius:3px;transition:width .3s ease}
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:38px 22px;text-align:center;gap:7px}
.ei{font-size:34px;opacity:.3}.et{font-family:'Cormorant Garamond',serif;font-size:16px;color:var(--t2)}.es{font-size:11px;color:var(--t2);line-height:1.6;max-width:210px}
.toast{position:fixed;top:64px;left:50%;transform:translateX(-50%);z-index:9998;background:var(--c2);border:1px solid var(--gb);padding:9px 16px;font-size:12px;color:var(--g);border-radius:var(--rsm);white-space:nowrap;box-shadow:0 8px 22px rgba(0,0,0,.6);animation:tIn .2s ease;max-width:290px;text-overflow:ellipsis;overflow:hidden}
@keyframes tIn{from{opacity:0;transform:translateX(-50%) translateY(-7px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
.fade-in{animation:fi .3s ease}@keyframes fi{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}
.badge-v{background:var(--gl);border:1px solid var(--gb);color:var(--g);font-size:8px;letter-spacing:2px;padding:3px 9px;border-radius:3px;text-transform:uppercase}
.sb-on{background:rgba(30,122,70,.15);border:1px solid rgba(30,122,70,.3);color:#3ecf7a;font-size:8px;letter-spacing:2px;padding:3px 9px;border-radius:3px;text-transform:uppercase}
.sb-off{background:rgba(176,48,48,.12);border:1px solid rgba(176,48,48,.25);color:#e05555;font-size:8px;letter-spacing:2px;padding:3px 9px;border-radius:3px;text-transform:uppercase}
.setup-screen{position:fixed;inset:0;z-index:10000;background:var(--c);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:24px 20px;overflow-y:auto}
.setup-logo{font-family:'Bebas Neue',sans-serif;font-size:32px;color:var(--g);letter-spacing:5px;text-align:center;line-height:1.1;margin-bottom:4px}
.setup-tagline{font-family:'Cormorant Garamond',serif;font-size:11px;color:var(--s);letter-spacing:3px;text-align:center;margin-bottom:20px}
`;
function Loader({text="LOADING"}){
  return (
    <div className="ldr">
      <div className="gw">
        <svg className="go" width="88" height="88" viewBox="0 0 88 88">
          <defs><filter id="gf"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs>
          <g filter="url(#gf)" transform="translate(44,44)">
            {[0,30,60,90,120,150,180,210,240,270,300,330].map((a,i)=>(
              <rect key={i} x="-3" y="-40" width="6" height="12" rx="2" fill="#D4AF37" transform={`rotate(${a})`}/>
            ))}
            <circle cx="0" cy="0" r="22" fill="none" stroke="#D4AF37" strokeWidth="1.2"/>
          </g>
        </svg>
        <svg className="gi" width="24" height="24" viewBox="0 0 24 24" style={{position:"absolute"}}>
          <circle cx="12" cy="12" r="8" fill="none" stroke="#D4AF37" strokeWidth="1" strokeDasharray="3 3"/>
          <circle cx="12" cy="12" r="3" fill="#D4AF37" opacity=".5"/>
        </svg>
      </div>
      <div className="lt">{text}</div>
      <div className="lb"/>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function Toast({msg,onClose}){
  useEffect(()=>{const t=setTimeout(onClose,3200);return()=>clearTimeout(t);},[onClose]);
  return <div className="toast">‚ú¶ {msg}</div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TOGGLE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function Tog({on,onChange,label}){
  return <div className="tog" onClick={onChange}><div className={`tog-t ${on?"on":""}`}><div className="tog-th"/></div>{label&&<span className="tog-l">{label}</span>}</div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MULTI-CHECK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function MultiCheck({items,selected,onToggle,label}){
  if(!items.length) return null;
  return (
    <div className="ig">
      {label&&<label className="il">{label}</label>}
      <div className="chk-row">
        {items.map(it=>{const on=selected.includes(it.id);return(
          <div key={it.id} className={`chk-item ${on?"on":""}`} onClick={()=>onToggle(it.id)}>
            <div className="chk-box">{on?"‚úì":""}</div>
            {it.icon&&<span>{it.icon}</span>}<span>{it.name}</span>
          </div>
        );})}
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê IMAGE UPLOAD ZONE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ImgZone({onChange,multiple=false,children}){
  return <div className="img-zone"><input type="file" accept="image/*" multiple={multiple} onChange={onChange}/>{children}</div>;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CAROUSEL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function Carousel({images=[]}){
  const [idx,setIdx]=useState(0);
  const ref=useRef(null);
  useEffect(()=>{
    const t=ref.current; if(!t) return;
    const fn=()=>setIdx(Math.round(t.scrollLeft/t.clientWidth));
    t.addEventListener("scroll",fn,{passive:true});
    return()=>t.removeEventListener("scroll",fn);
  },[]);
  const goTo=i=>{setIdx(i);ref.current?.children[i]?.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"});};
  if(!images.length) return <div className="crl" style={{height:200,display:"flex",alignItems:"center",justifyContent:"center",fontSize:60,opacity:.2}}>üì∑</div>;
  return (
    <div className="crl">
      <div className="crl-track" ref={ref}>
        {images.map((src,i)=><div key={i} className="crl-slide"><img src={src} alt={`i${i}`}/></div>)}
      </div>
      {images.length>1&&<>
        <div className="crl-dots">{images.map((_,i)=><div key={i} className={`cdot ${idx===i?"on":""}`}/>)}</div>
        <div className="crl-thumbs">{images.map((src,i)=><div key={i} className={`crl-tb ${idx===i?"on":""}`} onClick={()=>goTo(i)}><img src={src} alt="t"/></div>)}</div>
      </>}
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VOICE NOTE PLAYER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Generates deterministic fake waveform bars from a seed string
function seedBars(seed, count=40) {
  let h = 0;
  for (let i = 0; i < seed.length; i++) { h = ((h << 5) - h) + seed.charCodeAt(i); h |= 0; }
  const bars = [];
  for (let i = 0; i < count; i++) { h = ((h << 5) - h) + i * 7919; h |= 0; bars.push(8 + Math.abs(h % 20)); }
  return bars;
}

function VoiceNote({ msg, side }) {
  const [playing, setPlaying] = useState(false);
  const [progress, setProgress] = useState(0); // 0‚Äì1
  const [elapsed, setElapsed] = useState(0);
  const audioRef = useRef(null);
  const bars = useMemo(() => seedBars(msg.id || "x", 40), [msg.id]);
  const dur = msg.voice_duration || 0;

  useEffect(() => {
    if (!msg.voice_data) return;
    const audio = new Audio(msg.voice_data);
    audioRef.current = audio;
    audio.ontimeupdate = () => {
      setProgress(audio.currentTime / (audio.duration || 1));
      setElapsed(Math.floor(audio.currentTime));
    };
    audio.onended = () => { setPlaying(false); setProgress(0); setElapsed(0); };
    return () => { audio.pause(); audio.src = ""; };
  }, [msg.voice_data]);

  const toggle = () => {
    const a = audioRef.current;
    if (!a) return;
    if (playing) { a.pause(); setPlaying(false); }
    else { a.play().catch(() => {}); setPlaying(true); }
  };

  const fmtDur = s => `${Math.floor(s/60)}:${String(s%60).padStart(2,"0")}`;
  const played = Math.round(progress * bars.length);

  return (
    <div className={`vn-bubble ${side}`} onClick={toggle}>
      <button className="vn-play" onClick={e => { e.stopPropagation(); toggle(); }}>
        {playing ? "‚è∏" : "‚ñ∂"}
      </button>
      <div className="vn-waveform">
        {bars.map((h, i) => (
          <div key={i} className={`vn-bar ${i < played ? "played" : ""}`} style={{ height: h }}/>
        ))}
      </div>
      <div className="vn-dur">{fmtDur(playing ? elapsed : dur)}</div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CHAT INPUT BAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ChatInputBar({ onSendText, onSendVoice, disabled = false }) {
  const [text, setText] = useState("");
  const [recording, setRecording] = useState(false);
  const [recSecs, setRecSecs] = useState(0);
  const [waveBars, setWaveBars] = useState(Array(28).fill(4));
  const mediaRef = useRef(null);
  const chunksRef = useRef([]);
  const timerRef = useRef(null);
  const waveRef = useRef(null);
  const analyserRef = useRef(null);
  const animRef = useRef(null);

  const startRec = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const mr = new MediaRecorder(stream, { mimeType: MediaRecorder.isTypeSupported("audio/webm") ? "audio/webm" : "audio/ogg" });
      chunksRef.current = [];
      mr.ondataavailable = e => { if (e.data.size > 0) chunksRef.current.push(e.data); };
      mr.start(100);
      mediaRef.current = mr;
      setRecording(true); setRecSecs(0);

      // Timer
      timerRef.current = setInterval(() => setRecSecs(s => s + 1), 1000);

      // Animated wave bars using AudioContext
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const src = ctx.createMediaStreamSource(stream);
        const analyser = ctx.createAnalyser();
        analyser.fftSize = 64;
        src.connect(analyser);
        analyserRef.current = analyser;
        const data = new Uint8Array(analyser.frequencyBinCount);
        const animate = () => {
          analyser.getByteFrequencyData(data);
          const bars = Array.from({ length: 28 }, (_, i) => {
            const v = data[Math.floor(i * data.length / 28)] || 0;
            return Math.max(3, Math.round((v / 255) * 22));
          });
          setWaveBars(bars);
          animRef.current = requestAnimationFrame(animate);
        };
        animate();
      } catch { /* no visualizer ‚Äî still records */ }
    } catch {
      alert("Microphone access denied. Please allow mic permission.");
    }
  };

  const stopRec = async (send = true) => {
    clearInterval(timerRef.current);
    cancelAnimationFrame(animRef.current);
    setRecording(false); setWaveBars(Array(28).fill(4));

    const mr = mediaRef.current;
    if (!mr) return;
    const duration = recSecs;
    mr.stop();
    mr.stream?.getTracks().forEach(t => t.stop());

    if (!send) { chunksRef.current = []; return; }

    await new Promise(res => { mr.onstop = res; });
    const blob = new Blob(chunksRef.current, { type: mr.mimeType });
    // Convert to base64
    const reader = new FileReader();
    reader.onload = () => onSendVoice(reader.result, duration);
    reader.readAsDataURL(blob);
    chunksRef.current = [];
  };

  const fmtSecs = s => `${Math.floor(s/60)}:${String(s%60).padStart(2,"0")}`;

  if (recording) {
    return (
      <div className="rec-bar">
        <div className="rec-dot"/>
        <div className="rec-timer">{fmtSecs(recSecs)}</div>
        <div className="rec-waves">
          {waveBars.map((h, i) => <div key={i} className="rec-wave-bar" style={{ height: h }}/>)}
        </div>
        <button className="rec-cancel" onClick={() => stopRec(false)} title="Cancel">‚úï</button>
        <button className="rec-send" onClick={() => stopRec(true)} title="Send">‚úì</button>
      </div>
    );
  }

  return (
    <div className="chat-bar">
      <textarea
        className="chat-inp"
        placeholder={disabled ? "Chat locked‚Ä¶" : "Type a message‚Ä¶"}
        value={text}
        onChange={e => setText(e.target.value)}
        rows={1}
        disabled={disabled}
        onKeyDown={e => { if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); if (text.trim()) { onSendText(text); setText(""); } } }}
      />
      {text.trim()
        ? <button className="chat-send" onClick={() => { onSendText(text); setText(""); }}>‚û§</button>
        : <button className={`chat-mic ${recording ? "recording" : ""}`} onClick={startRec} disabled={disabled} title="Hold to record voice">üéô</button>
      }
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SPLASH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function Splash({onAccept}){
  const [loading,setLoading]=useState(true);
  const [scrolled,setScrolled]=useState(false);
  useEffect(()=>{setTimeout(()=>setLoading(false),2000);},[]);
  if(loading) return <><style>{CSS}</style><Loader text="INITIALISING"/></>;
  return (
    <div className="root fade-in"><style>{CSS}</style>
      <div className="splash">
        <div className="sp-brand">SURESH<br/>MILLGIN<br/>STORES</div>
        <div className="gold-line"/>
        <div className="sp-sub">Loom Machinery Spare Parts ¬∑ Est. 2004</div>
        <div className="policy-box" onScroll={e=>{if(e.target.scrollTop+e.target.clientHeight>=e.target.scrollHeight-8)setScrolled(true);}}>
          <h4>1. Data Collection</h4><p>By accessing this Platform you consent to collection of your Name, Email, Company, Mobile, IP Address, and usage analytics for internal operational purposes only.</p>
          <h4>2. Email Verification</h4><p>All accounts require OTP email verification. You are responsible for your credentials.</p>
          <h4>3. Data Breach Non-Liability</h4><p>Suresh Millgin Stores shall not be held liable for unauthorised access arising from external attacks, force majeure, or third-party failures. Industry-standard security is employed.</p>
          <h4>4. Communication Privacy</h4><p>No phone numbers are shared publicly. All communication via in-app chat or sureshmillginstoresapp@gmail.com</p>
          <h4>5. Pricing</h4><p>Prices subject to change. "Price on Request" items require direct enquiry.</p>
          <h4>6. Governing Law</h4><p>Governed by Indian law, jurisdiction: Gujarat.</p>
          <p style={{marginTop:12,color:"#D4AF37",fontSize:10}}>‚Üì Scroll to end to accept</p>
        </div>
        {!scrolled&&<div className="scroll-hint">‚Üì Scroll the policy to continue</div>}
        <button className="btn btn-g" disabled={!scrolled} onClick={onAccept}>{scrolled?"I ACCEPT ‚Äî CONTINUE":"SCROLL TO READ POLICY"}</button>
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const KEY_SESSION = "sms_session"; // { role:"user"|"admin", user:{...}, ts:number }

function StayCheckbox({checked, onChange}){
  return(
    <div onClick={onChange} style={{display:"flex",alignItems:"center",gap:10,cursor:"pointer",padding:"6px 0",marginBottom:14,userSelect:"none",WebkitUserSelect:"none"}}>
      <div style={{
        width:20,height:20,borderRadius:5,flexShrink:0,
        border:"2px solid "+(checked?"var(--g)":"var(--glb)"),
        background:checked?"var(--g)":"transparent",
        display:"flex",alignItems:"center",justifyContent:"center",
        fontSize:12,color:"#0f0f0f",transition:"all .18s"
      }}>{checked?"‚úì":""}</div>
      <span style={{fontSize:12,color:checked?"var(--t1)":"var(--t2)",fontWeight:checked?600:400}}>
        Stay logged in
      </span>
    </div>
  );
}

function Auth({onUserLogin,onAdminLogin}){
  const [mode,setMode]=useState("login");
  const [loading,setLoading]=useState(false);
  const [err,setErr]=useState(""); const [okMsg,setOkMsg]=useState("");
  const [sp,setSp]=useState(false); const [sp2,setSp2]=useState(false);
  const [f,setF]=useState({name:"",ferm:"",mob:"",email:"",password:""});
  const [le,setLe]=useState(""); const [lp,setLp]=useState("");
  const [stayIn,setStayIn]=useState(true);
  const [otp,setOtp]=useState(["","","","","",""]); const [go,setGo]=useState("");
  const otpR=useRef([]);
  const sf=(k,v)=>setF(p=>({...p,[k]:v}));

  // Save session so app auto-logs-in next time
  const saveSession=async(role,userData)=>{
    if(stayIn) await LS.set(KEY_SESSION,{role,user:userData,ts:Date.now()});
    else await LS.del(KEY_SESSION);
  };

  const doLogin=async()=>{
    setErr("");
    if(!le||!lp){setErr("Email and password required.");return;}
    if(le===ADMIN_EMAIL&&lp===ADMIN_PASS){
      setLoading(true);await new Promise(r=>setTimeout(r,700));setLoading(false);
      await saveSession("admin",{email:le});
      onAdminLogin();return;
    }
    if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(le)){setErr("Enter a valid email.");return;}
    if(lp.length<6){setErr("Incorrect credentials.");return;}
    setLoading(true);await new Promise(r=>setTimeout(r,700));setLoading(false);
    const u={name:le.split("@")[0],ferm:"",mob:"",email:le};
    await saveSession("user",u);
    onUserLogin(u);
  };

  const doReg=async()=>{
    setErr("");
    if(!f.name||!f.ferm||!f.mob||!f.email||!f.password){setErr("All fields required.");return;}
    if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(f.email)){setErr("Valid email required.");return;}
    if(f.password.length<6){setErr("Password must be 6+ characters.");return;}
    setLoading(true);await new Promise(r=>setTimeout(r,400));
    const code=genOTP();setGo(code);
    setLoading(false);setMode("otp");
  };

  const oi=(i,v)=>{if(!/^\d?$/.test(v))return;const n=[...otp];n[i]=v;setOtp(n);if(v&&i<5)otpR.current[i+1]?.focus();};
  const ok2=(i,e)=>{if(e.key==="Backspace"&&!otp[i]&&i>0)otpR.current[i-1]?.focus();};

  const doVerify=async()=>{
    if(otp.join("").length!==6){setErr("Enter all 6 digits.");return;}
    setLoading(true);await new Promise(r=>setTimeout(r,600));setLoading(false);
    if(otp.join("")===go){
      const u={name:f.name,ferm:f.ferm,mob:f.mob,email:f.email};
      await saveSession("user",u);
      onUserLogin(u);
    } else{setErr("Wrong code. Try again.");setOtp(["","","","","",""]);otpR.current[0]?.focus();}
  };

  const doResend=()=>{
    const c=genOTP();setGo(c);setOtp(["","","","","",""]);
    setOkMsg("New code generated!");setTimeout(()=>setOkMsg(""),3000);
    otpR.current[0]?.focus();
  };

  if(loading) return <><style>{CSS}</style><Loader text={mode==="otp"?"VERIFYING":"SIGNING IN"}/></>;
  return (
    <div className="root fade-in"><style>{CSS}</style>
      <div style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"22px 18px",overflowY:"auto"}}>
        <div style={{textAlign:"center",marginBottom:22}}>
          <div style={{fontFamily:"'Bebas Neue',sans-serif",fontSize:28,color:"var(--g)",letterSpacing:5}}>SURESH MILLGIN</div>
          <div style={{fontSize:9,color:"var(--t2)",letterSpacing:3,marginTop:3,textTransform:"uppercase"}}>Loom Machinery Spare Parts</div>
        </div>

        {/* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */}
        {mode==="login"&&(
          <div className="gc" style={{width:"100%",padding:"24px 18px",position:"relative",borderRadius:"var(--rad)"}}>
            <div className="ctl"/><div className="cbr"/>
            <div style={{fontFamily:"'Cormorant Garamond',serif",fontSize:22,color:"var(--t1)",textAlign:"center",marginBottom:3}}>Sign In</div>
            <div style={{fontSize:10,color:"var(--t2)",letterSpacing:2,textAlign:"center",marginBottom:20,textTransform:"uppercase"}}>Authorised Personnel Only</div>
            {err&&<div className="err-box">{err}</div>}
            <div className="ig">
              <label className="il">Email</label>
              <input className="inp" type="email" placeholder="your@email.com" value={le} onChange={e=>setLe(e.target.value)} autoCapitalize="none"/>
            </div>
            <div className="ig">
              <label className="il">Password</label>
              <div className="iw">
                <input className="inp" type={sp?"text":"password"} placeholder="Your password" value={lp} onChange={e=>setLp(e.target.value)} onKeyDown={e=>e.key==="Enter"&&doLogin()}/>
                <button className="ieye" onClick={()=>setSp(v=>!v)}>{sp?"üôà":"üëÅ"}</button>
              </div>
            </div>
            <StayCheckbox checked={stayIn} onChange={()=>setStayIn(v=>!v)}/>
            <button className="btn btn-g" onClick={doLogin}>SIGN IN</button>
            <div style={{textAlign:"center",fontSize:12,color:"var(--t2)",marginTop:14}}>
              New here? <span style={{color:"var(--g)",cursor:"pointer",fontWeight:700}} onClick={()=>{setMode("register");setErr("");}}>Create Account</span>
            </div>
          </div>
        )}

        {/* ‚îÄ‚îÄ REGISTER ‚îÄ‚îÄ */}
        {mode==="register"&&(
          <div className="gc" style={{width:"100%",padding:"24px 18px",position:"relative",borderRadius:"var(--rad)"}}>
            <div className="ctl"/><div className="cbr"/>
            <div style={{fontFamily:"'Cormorant Garamond',serif",fontSize:22,color:"var(--t1)",textAlign:"center",marginBottom:3}}>Create Account</div>
            <div style={{fontSize:10,color:"var(--t2)",letterSpacing:2,textAlign:"center",marginBottom:20,textTransform:"uppercase"}}>Verify your email</div>
            {err&&<div className="err-box">{err}</div>}
            <div className="ig"><label className="il">Full Name</label><input className="inp" placeholder="Your full name" value={f.name} onChange={e=>sf("name",e.target.value)}/></div>
            <div className="ig"><label className="il">Firm / Company</label><input className="inp" placeholder="Your company name" value={f.ferm} onChange={e=>sf("ferm",e.target.value)}/></div>
            <div className="ig"><label className="il">Mobile Number</label><input className="inp" placeholder="10-digit mobile" inputMode="numeric" value={f.mob} onChange={e=>sf("mob",e.target.value)} maxLength={10}/></div>
            <div className="ig"><label className="il">Email</label><input className="inp" type="email" placeholder="your@email.com" value={f.email} onChange={e=>sf("email",e.target.value)} autoCapitalize="none"/></div>
            <div className="ig">
              <label className="il">Password</label>
              <div className="iw">
                <input className="inp" type={sp2?"text":"password"} placeholder="Min 6 characters" value={f.password} onChange={e=>sf("password",e.target.value)}/>
                <button className="ieye" onClick={()=>setSp2(v=>!v)}>{sp2?"üôà":"üëÅ"}</button>
              </div>
            </div>
            <StayCheckbox checked={stayIn} onChange={()=>setStayIn(v=>!v)}/>
            <button className="btn btn-g" onClick={doReg}>GET VERIFICATION CODE</button>
            <button className="btn btn-ol" onClick={()=>{setMode("login");setErr("");}}>‚Üê Back to Sign In</button>
          </div>
        )}

        {/* ‚îÄ‚îÄ OTP ‚îÄ‚îÄ */}
        {mode==="otp"&&(
          <div className="gc" style={{width:"100%",padding:"24px 18px",position:"relative",borderRadius:"var(--rad)"}}>
            <div className="ctl"/><div className="cbr"/>
            <div style={{fontFamily:"'Cormorant Garamond',serif",fontSize:22,color:"var(--t1)",textAlign:"center",marginBottom:5}}>Verify Email</div>
            <div style={{fontSize:11,color:"var(--t2)",textAlign:"center",marginBottom:14,lineHeight:1.7}}>Your verification code for<br/><strong style={{color:"var(--g)"}}>{f.email}</strong></div>
            {err&&<div className="err-box">{err}</div>}
            {okMsg&&<div className="ok-box">{okMsg}</div>}
            {/* OTP displayed clearly on screen */}
            <div style={{background:"rgba(212,175,55,.07)",border:"1px solid var(--gb)",borderRadius:"var(--rsm)",padding:"13px 11px",textAlign:"center",marginBottom:16}}>
              <div style={{fontSize:9,color:"var(--t2)",letterSpacing:2,marginBottom:5,textTransform:"uppercase"}}>Your Code</div>
              <div style={{fontFamily:"'Bebas Neue',sans-serif",fontSize:34,color:"var(--g)",letterSpacing:10,lineHeight:1}}>{go}</div>
              <div style={{fontSize:9,color:"var(--t2)",marginTop:5}}>Enter the digits below</div>
            </div>
            <div style={{display:"flex",gap:7,justifyContent:"center",marginBottom:16}}>
              {otp.map((v,i)=>(<input key={i} ref={el=>otpR.current[i]=el} className="otp-box" inputMode="numeric" maxLength={1} value={v} onChange={e=>oi(i,e.target.value)} onKeyDown={e=>ok2(i,e)}/>))}
            </div>
            <button className="btn btn-g" onClick={doVerify}>VERIFY & ENTER</button>
            <button className="btn btn-ol" onClick={doResend}>Generate New Code</button>
            <button className="btn btn-ol" onClick={()=>{setMode("register");setErr("");setOtp(["","","","","",""]);}} style={{marginTop:6}}>‚Üê Change Details</button>
          </div>
        )}
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOAD SB CONFIG ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadSBConfig(){
  const cfg = await LS.get(KEY_SB);
  if(cfg?.url && cfg?.key){ _sb = new SB(cfg.url, cfg.key); return cfg; }
  return null;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê USER APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function UserApp({user,ip,onLogout}){
  const [tab,setTab]=useState("home");
  const [cats,setCats]=useState([]);
  const [prods,setProds]=useState([]);
  const [selCat,setSelCat]=useState(null);
  const [selSub,setSelSub]=useState(null);
  const [search,setSearch]=useState("");
  const [selProd,setSelProd]=useState(null);
  const [chats,setChats]=useState([]);
  const [chatInp,setChatInp]=useState("");
  const [notifs,setNotifs]=useState([]);
  const [reads,setReads]=useState([]);
  const [viewHist,setViewHist]=useState([]);
  const [toast,setToast]=useState(null);
  const [loading,setLoading]=useState(true);
  const notify=m=>setToast(m);

  useEffect(()=>{
    (async()=>{
      const [c,p,ch,n,r,vh]=await Promise.all([
        DB.getCats(),DB.getProds(),DB.getChats(),
        DB.getNotifs(),DB.getReads(user.email),DB.getUserViews(user.email),
      ]);
      setCats(c);setProds(p);
      setChats(ch.filter(m=>(m.user_email||m.userEmail)===user.email));
      setNotifs(n);setReads(r);setViewHist(vh);
      setLoading(false);
      await DB.addAudit({id:uid(),user_name:user.name,user_email:user.email,firm:user.ferm,mobile:user.mob,ip_address:ip,action:"Logged in",logged_at:nowIST()});
    })();
  },[]);

  const mainCats=cats.filter(c=>!c.parent_id);
  const subCatsOf=id=>cats.filter(c=>c.parent_id===id);
  const activeSubs=selCat?subCatsOf(selCat):[];

  const filtered=useMemo(()=>prods.filter(p=>{
    const cids=p.category_ids||[];
    const sids=p.sub_category_ids||[];
    const cm=!selCat||cids.includes(selCat);
    const sm=!selSub||sids.includes(selSub);
    const km=!search||p.name.toLowerCase().includes(search.toLowerCase());
    return cm&&sm&&km;
  }),[prods,selCat,selSub,search]);

  const recommendations=useMemo(()=>{
    const cc={};
    viewHist.forEach(v=>(v.category_ids||[]).forEach(id=>{cc[id]=(cc[id]||0)+1;}));
    const top=Object.entries(cc).sort((a,b)=>b[1]-a[1]).slice(0,4).map(e=>e[0]);
    const seen=new Set(viewHist.map(v=>v.product_id));
    return prods.filter(p=>(p.category_ids||[]).some(id=>top.includes(id))&&!seen.has(p.id)).slice(0,8);
  },[prods,viewHist]);

  const unread=notifs.filter(n=>!reads.includes(n.id)).length;

  const viewProd=async p=>{
    setSelProd(p);
    const e={id:uid(),user_email:user.email,product_id:p.id,category_ids:p.category_ids||[],ip_address:ip,viewed_at:nowIST()};
    setViewHist(prev=>[e,...prev]);
    await DB.addView(e);
    await DB.addAudit({id:uid(),user_name:user.name,user_email:user.email,firm:user.ferm,mobile:user.mob,ip_address:ip,action:`Viewed: ${p.name}`,logged_at:nowIST()});
  };

  const sendChat=async()=>{
    if(!chatInp.trim()) return;
    const m={id:uid(),user_email:user.email,from_role:"user",message:chatInp,locked:true,sent_at:nowIST()};
    setChats(p=>[...p,m]);setChatInp("");
    await DB.addChat(m);
    notify("Enquiry sent ‚Äî awaiting admin approval");
  };

  const markRead=async id=>{
    await DB.markRead(id,user.email);
    setReads(p=>[...p,id]);
  };

  const getImg=p=>(p.images||[])[0]||null;
  const getCatImg=c=>c.image_url||null;
  const chatLocked=!chats.some(m=>m.locked===false);
  const getCatName=id=>cats.find(c=>c.id===id)?.name||"";

  const navs=[
    {id:"home",icon:"‚åÇ",label:"Home"},
    {id:"catalog",icon:"‚ò∞",label:"Catalog"},
    {id:"chat",icon:"‚úâ",label:"Enquire"},
    {id:"notifs",icon:"üîî",label:"Alerts"},
    {id:"profile",icon:"‚óé",label:"Profile"},
  ];

  if(loading) return <><style>{CSS}</style><Loader text="LOADING CATALOG"/></>;

  return (
    <div className="root fade-in"><style>{CSS}</style>
      {toast&&<Toast msg={toast} onClose={()=>setToast(null)}/>}

      {/* ‚îÄ‚îÄ PRODUCT DETAIL ‚îÄ‚îÄ */}
      {selProd&&(
        <div className="pd">
          <div className="hdr">
            <button className="hbk" onClick={()=>setSelProd(null)}>‚Äπ</button>
            <div className="hdr-title">PRODUCT</div><div/>
          </div>
          <div className="pd-scr">
            <Carousel images={selProd.images||[]}/>
            {selProd.video&&(
              <div className="vid-player" style={{margin:"0 0 0 0"}}>
                <video src={selProd.video} controls playsInline preload="metadata" style={{width:"100%",maxHeight:240,background:"#000",display:"block"}}/>
                <div style={{padding:"7px 12px",background:"var(--c2)",display:"flex",alignItems:"center",gap:7,borderTop:"1px solid var(--glb)"}}>
                  <span style={{fontSize:13}}>üé¨</span>
                  <span style={{fontSize:10,color:"var(--t2)",letterSpacing:1}}>PRODUCT VIDEO</span>
                </div>
              </div>
            )}
            <div className="pd-info">
              <div className="pd-cat">{(selProd.category_ids||[]).map(getCatName).filter(Boolean).join(" ¬∑ ")}</div>
              <div className="pd-name">{selProd.name}</div>
              <div className={`pd-price ${selProd.price_on_request?"na":""}`}>
                {selProd.price_on_request?"Price on Request":selProd.price?"‚Çπ "+Number(selProd.price).toLocaleString("en-IN"):"‚Äî"}
              </div>
              <div className="pd-hr"/>
              <div className="pd-desc">{selProd.description||"No description provided."}</div>
            </div>
          </div>
          <div className="pd-acts">
            <button className="btn btn-g" style={{flex:1}} onClick={()=>{setSelProd(null);setTab("chat");notify("Enquiry opened for "+selProd.name);}}>ENQUIRE NOW</button>
          </div>
        </div>
      )}

      {/* ‚îÄ‚îÄ HOME ‚îÄ‚îÄ */}
      {tab==="home"&&(
        <>
          <div className="hdr"><div className="hdr-title">SURESH MILLGIN</div><div className="badge-v">VERIFIED</div></div>
          <div className="page">
            <div className="home-hero">
              <div className="hero-brand">SURESH MILLGIN<br/>STORES</div>
              <div className="hero-tag">Precision parts, trusted quality.</div>
              <div className="hero-est">EST. 2004 ¬∑ LOOM MACHINERY SPARE PARTS</div>
            </div>

            {/* Unread notification banner */}
            {unread>0&&notifs.filter(n=>!reads.includes(n.id)).slice(0,1).map(n=>(
              <div key={n.id} className="notif-banner" onClick={()=>{markRead(n.id);setTab("notifs");}}>
                <div className="notif-banner-title">üîî {n.title}</div>
                <div className="notif-banner-msg">{n.message}</div>
              </div>
            ))}

            {/* CATEGORIES */}
            <div className="sechd"><div className="sectit">Categories</div><div className="secct">{mainCats.length} cats</div></div>
            {mainCats.length===0
              ?<div style={{padding:"0 16px 10px"}}><div style={{background:"var(--c3)",border:"1px solid var(--glb)",borderRadius:"var(--rsm)",padding:"11px",fontSize:11,color:"var(--t2)"}}>Categories appear once admin adds them.</div></div>
              :<div className="cat-row">
                {mainCats.map(c=>(
                  <div key={c.id} className={`cat-card ${selCat===c.id?"on":""}`} onClick={()=>{setSelCat(c.id===selCat?null:c.id);setSelSub(null);setTab("catalog");}}>
                    {getCatImg(c)?<img className="cat-thumb" src={getCatImg(c)} alt={c.name}/>:<div className="cat-ph">{c.icon||"‚óà"}</div>}
                    <div className="cat-lbl"><div className="cat-lbl-name">{c.name}</div><div className="cat-lbl-ct">{prods.filter(p=>(p.category_ids||[]).includes(c.id)).length} items</div></div>
                  </div>
                ))}
              </div>
            }

            {/* RECOMMENDATIONS */}
            {recommendations.length>0&&(
              <>
                <div className="sechd"><div className="sectit">Recommended for You</div><div className="secct">Based on history</div></div>
                <div className="rec-row">
                  {recommendations.map(p=>(
                    <div key={p.id} className="rec-card" onClick={()=>viewProd(p)}>
                      <div className="rec-img">{getImg(p)?<img src={getImg(p)} alt={p.name}/>:(p.icon||"üî©")}</div>
                      <div className="rec-body">
                        <div className="rec-name">{p.name}</div>
                        <div className={`rec-price ${p.price_on_request?"na":""}`}>{p.price_on_request?"Price on Request":p.price?"‚Çπ"+Number(p.price).toLocaleString("en-IN"):"‚Äî"}</div>
                      </div>
                    </div>
                  ))}
                </div>
              </>
            )}

            {/* ALL PRODUCTS */}
            <div className="sechd"><div className="sectit">All Products</div><div className="secct">{prods.length} items</div></div>
            {prods.length===0
              ?<div className="empty"><div className="ei">üì¶</div><div className="et">No products yet</div><div className="es">Products appear once admin adds them.</div></div>
              :<div className="prod-list">
                {prods.slice(0,8).map(p=>(
                  <div key={p.id} className="prod-row" onClick={()=>viewProd(p)}>
                    <div className="pthumb">{getImg(p)?<img src={getImg(p)} alt={p.name}/>:(p.icon||"üî©")}</div>
                    <div className="pbody">
                      <div className="pcat">{(p.category_ids||[]).map(getCatName).filter(Boolean).join(", ")}</div>
                      <div className="pname">{p.name}</div>
                      <div className={`pprice ${p.price_on_request?"na":""}`}>{p.price_on_request?"Price on Request":p.price?"‚Çπ"+Number(p.price).toLocaleString("en-IN"):"‚Äî"}</div>
                    </div>
                    <div style={{fontSize:15,color:"var(--t2)"}}>‚Ä∫</div>
                  </div>
                ))}
              </div>
            }
            {prods.length>8&&<div style={{padding:"11px 16px"}}><button className="btn btn-ol" style={{fontSize:11,letterSpacing:2,marginTop:0}} onClick={()=>setTab("catalog")}>VIEW ALL {prods.length} PRODUCTS ‚Üí</button></div>}
          </div>
        </>
      )}

      {/* ‚îÄ‚îÄ CATALOG ‚îÄ‚îÄ */}
      {tab==="catalog"&&(
        <>
          <div className="hdr"><div className="hdr-title">CATALOG</div><div style={{fontSize:10,color:"var(--t2)"}}>{filtered.length} items</div></div>
          <div className="page">
            <div className="srch"><div className="srch-in"><input className="srch-inp" placeholder="Search parts..." value={search} onChange={e=>setSearch(e.target.value)}/></div></div>
            {mainCats.length>0&&(
              <div className="cat-row">
                <div className={`cat-card ${!selCat?"on":""}`} style={{minWidth:74}} onClick={()=>{setSelCat(null);setSelSub(null);}}>
                  <div className="cat-ph" style={{height:58,fontSize:20}}>‚óà</div>
                  <div className="cat-lbl"><div className="cat-lbl-name">All</div><div className="cat-lbl-ct">{prods.length}</div></div>
                </div>
                {mainCats.map(c=>(
                  <div key={c.id} className={`cat-card ${selCat===c.id?"on":""}`} onClick={()=>{setSelCat(c.id===selCat?null:c.id);setSelSub(null);}}>
                    {getCatImg(c)?<img className="cat-thumb" src={getCatImg(c)} alt={c.name}/>:<div className="cat-ph">{c.icon||"‚óà"}</div>}
                    <div className="cat-lbl"><div className="cat-lbl-name">{c.name}</div><div className="cat-lbl-ct">{prods.filter(p=>(p.category_ids||[]).includes(c.id)).length}</div></div>
                  </div>
                ))}
              </div>
            )}
            {/* Sub-category chips appear when a main cat is selected */}
            {selCat&&activeSubs.length>0&&(
              <div className="sub-row">
                <div className={`sub-chip ${!selSub?"on":""}`} onClick={()=>setSelSub(null)}>All</div>
                {activeSubs.map(s=><div key={s.id} className={`sub-chip ${selSub===s.id?"on":""}`} onClick={()=>setSelSub(s.id===selSub?null:s.id)}>{s.icon&&s.icon+" "}{s.name}</div>)}
              </div>
            )}
            {filtered.length===0
              ?<div className="empty"><div className="ei">üîç</div><div className="et">{prods.length===0?"No products yet":"No results"}</div><div className="es">{prods.length===0?"Products appear once admin adds them.":"Try a different search or filter."}</div></div>
              :<div className="prod-list">
                {filtered.map(p=>(
                  <div key={p.id} className="prod-row" onClick={()=>viewProd(p)}>
                    <div className="pthumb">{getImg(p)?<img src={getImg(p)} alt={p.name}/>:(p.icon||"üî©")}</div>
                    <div className="pbody">
                      <div className="pcat">{(p.category_ids||[]).map(getCatName).filter(Boolean).join(", ")}</div>
                      <div className="pname">{p.name}</div>
                      <div className={`pprice ${p.price_on_request?"na":""}`}>{p.price_on_request?"Price on Request":p.price?"‚Çπ"+Number(p.price).toLocaleString("en-IN"):"‚Äî"}</div>
                    </div>
                    <div style={{fontSize:15,color:"var(--t2)"}}>‚Ä∫</div>
                  </div>
                ))}
              </div>
            }
          </div>
        </>
      )}

      {/* ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ */}
      {tab==="chat"&&(
        <>
          <div className="hdr"><div className="hdr-title">ENQUIRE</div></div>
          <div className="page">
            <div style={{padding:"10px 16px 0"}}><div style={{background:"var(--c3)",border:"1px solid var(--glb)",borderRadius:"var(--rsm)",padding:"11px 13px",fontSize:11,color:"var(--t2)",lineHeight:1.8}}>üìß <span style={{color:"var(--g)"}}>sureshmillginstoresapp@gmail.com</span><br/>Send a message or hold üéô to record a voice note.</div></div>
            <div className="chat-msgs">
              {chats.length===0&&<div className="empty" style={{paddingTop:24}}><div className="ei">‚úâ</div><div className="et">Start an Enquiry</div><div className="es">Type a message or send a voice note below.</div></div>}
              {chats.map(m=>{
                const side = m.from_role==="user" ? "u" : "a";
                const isVoice = m.msg_type==="voice";
                return (
                  <div key={m.id} className={`cm ${side}`}>
                    {isVoice
                      ? <VoiceNote msg={m} side={side}/>
                      : <div className={`cb ${side}`}>{m.message}</div>
                    }
                    <div className="cts">{m.sent_at} ¬∑ {m.from_role==="admin"?"Support":user.name}</div>
                  </div>
                );
              })}
            </div>
            {chatLocked&&chats.length>0&&<div className="chat-locked"><div className="chat-locked-t">üîí Awaiting admin approval to unlock chat</div></div>}
            {(!chatLocked||chats.length===0)&&(
              <ChatInputBar
                onSendText={async txt=>{
                  const m={id:uid(),user_email:user.email,from_role:"user",message:txt,msg_type:"text",locked:true,sent_at:nowIST()};
                  setChats(p=>[...p,m]); await DB.addChat(m); notify("Enquiry sent");
                }}
                onSendVoice={async(audioData,duration)=>{
                  const m={id:uid(),user_email:user.email,from_role:"user",message:"üéô Voice note",msg_type:"voice",voice_data:audioData,voice_duration:duration,locked:true,sent_at:nowIST()};
                  setChats(p=>[...p,m]); await DB.addChat(m); notify("Voice note sent");
                }}
              />
            )}
          </div>
        </>
      )}

      {/* ‚îÄ‚îÄ NOTIFICATIONS ‚îÄ‚îÄ */}
      {tab==="notifs"&&(
        <>
          <div className="hdr"><div className="hdr-title">NOTIFICATIONS</div>{unread>0&&<div style={{fontSize:10,color:"var(--g)",letterSpacing:1}}>{unread} new</div>}</div>
          <div className="page">
            {notifs.length===0
              ?<div className="empty"><div className="ei">üîî</div><div className="et">No notifications</div><div className="es">Admin notifications appear here.</div></div>
              :notifs.map(n=>{const r=reads.includes(n.id);return(
                <div key={n.id} className="notif-item" onClick={()=>!r&&markRead(n.id)} style={{cursor:r?"default":"pointer"}}>
                  <div className={`ndot ${r?"read":""}`}/>
                  <div style={{flex:1}}>
                    <div className="ntit">{n.title}</div>
                    <div className="nmsg">{n.message}</div>
                    <div className="nts">{n.created_at}{!r&&<span style={{color:"var(--g)",marginLeft:8}}>Tap to mark read</span>}</div>
                  </div>
                </div>
              );})}
          </div>
        </>
      )}

      {/* ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ */}
      {tab==="profile"&&(
        <>
          <div className="hdr"><div className="hdr-title">PROFILE</div></div>
          <div className="page">
            <div className="gc prof-card"><div className="ctl"/><div className="cbr"/>
              <div className="prof-av">üë§</div>
              <div className="prof-name">{user.name}</div>
              {user.ferm&&<div style={{fontSize:12,color:"var(--g)",letterSpacing:1}}>{user.ferm}</div>}
              <div style={{fontSize:10,color:"var(--t2)",marginTop:2}}>{user.email}</div>
              {ip&&<div style={{fontSize:9,color:"var(--t2)",marginTop:3,fontFamily:"monospace"}}>IP: {ip}</div>}
            </div>
            {[["üì¶","My Enquiries"],["‚öôÔ∏è","Settings"],["‚ÑπÔ∏è","About"]].map(([ic,lb],i)=>(
              <div key={i} className="prof-row" onClick={()=>notify(lb+" ‚Äî coming soon")}>
                <div style={{fontSize:17,width:26,textAlign:"center"}}>{ic}</div><div className="prof-row-lbl">{lb}</div><div style={{fontSize:14,color:"var(--t2)"}}>‚Ä∫</div>
              </div>
            ))}
            <div className="prof-row" onClick={onLogout}>
              <div style={{fontSize:17,width:26,textAlign:"center"}}>üö™</div><div className="prof-row-lbl" style={{color:"#e05555"}}>Logout</div><div style={{fontSize:14,color:"var(--t2)"}}>‚Ä∫</div>
            </div>
          </div>
        </>
      )}

      <div className="bnav">
        {navs.map(n=>(
          <div key={n.id} className={`bn ${tab===n.id?"on":""}`} onClick={()=>setTab(n.id)}>
            <div className="bn-i">{n.icon}</div>
            {n.id==="notifs"&&unread>0&&<div className="bn-badge">{unread}</div>}
            <div className="bn-l">{n.label}</div>
          </div>
        ))}
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ADMIN APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function AdminApp({onLogout}){
  const [tab,setTab]=useState("dashboard");
  const [cats,setCats]=useState([]);
  const [prods,setProds]=useState([]);
  const [chats,setChats]=useState([]);
  const [audit,setAudit]=useState([]);
  const [views,setViews]=useState([]);
  const [notifs,setNotifs]=useState([]);
  const [sbCfg,setSbCfg]=useState({url:"",key:""});
  const [sbOn,setSbOn]=useState(false);
  const [toast,setToast]=useState(null);
  const [loading,setLoading]=useState(true);
  const notify=m=>setToast(m);

  // Forms
  const [newCat,setNewCat]=useState({name:"",icon:"",image:null,parent_id:""});
  const [editCat,setEditCat]=useState(null);
  const [newProd,setNewProd]=useState({name:"",category_ids:[],sub_category_ids:[],icon:"",price:"",price_on_request:false,description:"",images:[],video:null});
  const [newNotif,setNewNotif]=useState({title:"",message:""});
  const [selChat,setSelChat]=useState(null);
  const [replyTxt,setReplyTxt]=useState("");

  // Cleanup state
  const [clFrom,setClFrom]=useState("");
  const [clTo,setClTo]=useState("");
  const [clSel,setClSel]=useState([]);
  const [clConfirm,setClConfirm]=useState(false);
  const [clProgress,setClProgress]=useState(0);
  const [clRunning,setClRunning]=useState(false);
  const [clDone,setClDone]=useState(null);

  useEffect(()=>{
    (async()=>{
      const cfg=await LS.get(KEY_SB);
      if(cfg?.url&&cfg?.key){ _sb=new SB(cfg.url,cfg.key); setSbCfg(cfg); setSbOn(true); }
      const [c,p,ch,a,v,n]=await Promise.all([DB.getCats(),DB.getProds(),DB.getChats(),DB.getAudit(),DB.getAllViews(),DB.getNotifs()]);
      setCats(c);setProds(p);setChats(ch);setAudit(a);setViews(v);setNotifs(n);
      setLoading(false);
    })();
  },[]);

  // Derived
  const mainCats=cats.filter(c=>!c.parent_id);
  const subCatsOf=id=>cats.filter(c=>c.parent_id===id);
  const getCatName=id=>cats.find(c=>c.id===id)?.name||"‚Äî";

  // ‚îÄ‚îÄ SUPABASE ‚îÄ‚îÄ
  const connectSB=async()=>{
    if(!sbCfg.url||!sbCfg.key){notify("Enter both URL and key");return;}
    try{
      _sb=new SB(sbCfg.url,sbCfg.key);
      await _sb.sel("sms_categories");
      await LS.set(KEY_SB,sbCfg);
      setSbOn(true);
      // Reload data from Supabase
      const [c,p,ch,a,v,n]=await Promise.all([DB.getCats(),DB.getProds(),DB.getChats(),DB.getAudit(),DB.getAllViews(),DB.getNotifs()]);
      setCats(c);setProds(p);setChats(ch);setAudit(a);setViews(v);setNotifs(n);
      notify("‚úì Supabase connected! Data loaded.");
    }catch(e){notify("Connection failed: "+e.message);_sb=null;}
  };
  const disconnectSB=async()=>{_sb=null;await LS.del(KEY_SB);setSbOn(false);setSbCfg({url:"",key:""});notify("Disconnected from Supabase ‚Äî using local storage.");};
  const resetAndReconnect=async()=>{_sb=null;await LS.del(KEY_SB);window.location.reload();};

  // ‚îÄ‚îÄ CATEGORY IMAGE UPLOAD ‚îÄ‚îÄ
  const handleCatImg=async(e,setter)=>{
    const file=e.target.files?.[0]; if(!file) return;
    notify("Uploading image...");
    const url=await DB.uploadImg(file,"categories");
    setter(p=>({...p,image:url,image_url:url}));
    notify("Image uploaded ‚úì");
  };

  // ‚îÄ‚îÄ ADD CATEGORY ‚îÄ‚îÄ
  const addCat=async()=>{
    if(!newCat.name.trim()){notify("Name required");return;}
    const cat={id:uid(),name:newCat.name.trim(),icon:newCat.icon||"‚óà",image_url:newCat.image||null,parent_id:newCat.parent_id||null,sort_order:cats.length,created_at:nowIST()};
    await DB.saveCat(cat);
    setCats(p=>[...p,cat]);
    setNewCat({name:"",icon:"",image:null,parent_id:""});
    notify(`${newCat.parent_id?"Sub-category":"Category"} added`);
  };

  // ‚îÄ‚îÄ SAVE EDIT CATEGORY ‚îÄ‚îÄ
  const saveEditCat=async()=>{
    if(!editCat?.name?.trim()){notify("Name required");return;}
    await DB.saveCat(editCat);
    setCats(p=>p.map(c=>c.id===editCat.id?editCat:c));
    setEditCat(null);notify("Category updated");
  };

  // ‚îÄ‚îÄ DELETE CATEGORY ‚îÄ‚îÄ
  const deleteCat=async id=>{
    await DB.delCat(id);
    setCats(p=>p.filter(c=>c.id!==id&&c.parent_id!==id));
    notify("Deleted");
  };

  // ‚îÄ‚îÄ PRODUCT IMAGES ‚îÄ‚îÄ
  const handleProdImgs=async e=>{
    const files=Array.from(e.target.files||[]); if(!files.length) return;
    notify(`Uploading ${files.length} image(s)...`);
    const urls=await Promise.all(files.map(f=>DB.uploadImg(f,"products")));
    setNewProd(p=>({...p,images:[...p.images,...urls]}));
    notify(`${files.length} image(s) added ‚úì`);
    e.target.value="";
  };

  // ‚îÄ‚îÄ PRODUCT VIDEO ‚îÄ‚îÄ
  const handleProdVideo=async e=>{
    const file=e.target.files?.[0]; if(!file) return;
    const maxMB=50;
    if(file.size>maxMB*1024*1024){notify(`Video too large ‚Äî max ${maxMB}MB`);e.target.value="";return;}
    notify("Uploading video‚Ä¶");
    try{
      const url=await DB.uploadVideo(file);
      setNewProd(p=>({...p,video:url}));
      notify("Video uploaded ‚úì");
    }catch(err){notify("Video upload failed: "+err.message);}
    e.target.value="";
  };

  // ‚îÄ‚îÄ ADD PRODUCT ‚îÄ‚îÄ
  const addProd=async()=>{
    if(!newProd.name.trim()){notify("Product name required");return;}
    const p={id:uid(),name:newProd.name.trim(),category_ids:newProd.category_ids,sub_category_ids:newProd.sub_category_ids,icon:newProd.icon||"üî©",price:newProd.price_on_request?null:Number(newProd.price)||null,price_on_request:newProd.price_on_request,description:newProd.description,images:newProd.images,video:newProd.video||null,created_at:nowIST()};
    await DB.saveProd(p);
    setProds(prev=>[...prev,p]);
    setNewProd({name:"",category_ids:[],sub_category_ids:[],icon:"",price:"",price_on_request:false,description:"",images:[],video:null});
    notify("Product added");
  };

  const deleteProd=async id=>{await DB.delProd(id);setProds(p=>p.filter(x=>x.id!==id));notify("Deleted");};
  const toggleNA=async id=>{
    const t=prods.find(p=>p.id===id);
    const u={...t,price_on_request:!t.price_on_request,price:t.price_on_request?t.price:null};
    await DB.saveProd(u);setProds(p=>p.map(x=>x.id===id?u:x));notify("Price visibility updated");
  };

  // ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ
  const uniqueUsers=[...new Set(chats.map(m=>m.user_email).filter(Boolean))];
  const grantChat=async email=>{
    await DB.unlockChat(email);
    setChats(p=>p.map(m=>m.user_email===email?{...m,locked:false}:m));
    notify("Chat unlocked for "+email);
  };
  const sendReply=async email=>{
    if(!replyTxt.trim()) return;
    const m={id:uid(),user_email:email,from_role:"admin",message:replyTxt,locked:false,sent_at:nowIST()};
    setChats(p=>[...p,m]);await DB.addChat(m);setReplyTxt("");notify("Reply sent");
  };

  // ‚îÄ‚îÄ NOTIFICATIONS ‚îÄ‚îÄ
  const sendNotif=async()=>{
    if(!newNotif.title.trim()||!newNotif.message.trim()){notify("Title and message required");return;}
    const n={id:uid(),title:newNotif.title.trim(),message:newNotif.message.trim(),target:"all",created_at:nowIST()};
    await DB.addNotif(n);setNotifs(p=>[n,...p]);
    setNewNotif({title:"",message:""});notify("Notification sent to all users");
  };

  // ‚îÄ‚îÄ USER ACTIVITY ‚îÄ‚îÄ
  const userActivity=useMemo(()=>{
    const map={};
    [...audit,...views].forEach(a=>{
      const email=a.user_email;
      if(!email) return;
      if(!map[email])map[email]={email,name:a.user_name||email.split("@")[0],firm:a.firm||"‚Äî",events:[]};
      map[email].events.push({action:a.action||`Viewed: ${a.product_id||"unknown"}`,time:a.logged_at||a.viewed_at,ip:a.ip_address||"‚Äî"});
    });
    // Sort events newest first
    Object.values(map).forEach(u=>u.events.sort((a,b)=>b.time?.localeCompare(a.time||"")||0));
    return Object.values(map);
  },[audit,views]);

  // Supabase SQL schema text
  const SCHEMA=`-- Run this in your Supabase SQL Editor --

create table if not exists sms_categories (
  id text primary key, name text not null,
  icon text, image_url text,
  parent_id text, sort_order int default 0,
  created_at text
);
create table if not exists sms_products (
  id text primary key, name text,
  description text, price numeric,
  price_on_request boolean default false,
  icon text, images text[] default '{}',
  category_ids text[] default '{}',
  sub_category_ids text[] default '{}',
  created_at text
);
create table if not exists sms_chats (
  id text primary key, user_email text,
  from_role text, message text,
  locked boolean default true, sent_at text
);
create table if not exists sms_view_hist (
  id text primary key, user_email text,
  product_id text, category_ids text[] default '{}',
  ip_address text, viewed_at text
);
create table if not exists sms_audit (
  id text primary key, user_name text,
  user_email text, firm text,
  mobile text, ip_address text,
  action text, logged_at text
);
create table if not exists sms_notifs (
  id text primary key, title text,
  message text, target text default 'all',
  created_at text
);
create table if not exists sms_notif_reads (
  id text primary key, notif_id text,
  user_email text
);

-- Enable RLS on all tables
alter table sms_categories enable row level security;
alter table sms_products enable row level security;
alter table sms_chats enable row level security;
alter table sms_view_hist enable row level security;
alter table sms_audit enable row level security;
alter table sms_notifs enable row level security;
alter table sms_notif_reads enable row level security;

-- Allow all (use anon key for this demo)
create policy "open" on sms_categories for all using (true) with check (true);
create policy "open" on sms_products for all using (true) with check (true);
create policy "open" on sms_chats for all using (true) with check (true);
create policy "open" on sms_view_hist for all using (true) with check (true);
create policy "open" on sms_audit for all using (true) with check (true);
create policy "open" on sms_notifs for all using (true) with check (true);
create policy "open" on sms_notif_reads for all using (true) with check (true);

-- Storage: Create a public bucket named: sms-images`;

  const adminNavs=[
    {id:"dashboard",icon:"‚óà",label:"Dash"},
    {id:"categories",icon:"üè∑",label:"Cats"},
    {id:"products",icon:"üì¶",label:"Prods"},
    {id:"chats",icon:"‚úâ",label:"Chats"},
    {id:"activity",icon:"üëÅ",label:"Activity"},
    {id:"notifs",icon:"üîî",label:"Notifs"},
    {id:"cleanup",icon:"üßπ",label:"Cleanup"},
    {id:"supabase",icon:"üóÑ",label:"DB"},
  ];

  if(loading) return <><style>{CSS}</style><Loader text="LOADING ADMIN"/></>;

  return (
    <div className="root fade-in"><style>{CSS}</style>
      {toast&&<Toast msg={toast} onClose={()=>setToast(null)}/>}
      <div className="hdr">
        <div className="hdr-title" style={{color:"var(--g)"}}>ADMIN</div>
        <div style={{display:"flex",alignItems:"center",gap:7}}>
          <div className={sbOn?"sb-on":"sb-off"}>{sbOn?"‚òÅ CLOUD":"üì± LOCAL"}</div>
          <button className="btn btn-danger btn-sm" onClick={onLogout} style={{width:"auto",padding:"6px 10px"}}>EXIT</button>
        </div>
      </div>
      <div className="adm-tabs">{adminNavs.map(n=><div key={n.id} className={`at ${tab===n.id?"on":""}`} onClick={()=>setTab(n.id)}>{n.icon} {n.label}</div>)}</div>

      <div className="adm-body fade-in">

        {/* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */}
        {tab==="dashboard"&&(
          <>
            <div className="stat-grid">
              {[[prods.length,"Products"],[mainCats.length,"Main Cats"],[cats.filter(c=>c.parent_id).length,"Sub Cats"],[uniqueUsers.length,"Enquiries"],[notifs.length,"Notifications"],[userActivity.length,"Users Tracked"]].map(([n,l],i)=>(
                <div key={i} className="stat-box"><div className="stat-n">{n}</div><div className="stat-l">{l}</div></div>
              ))}
            </div>
            <div className="chart-card">
              <div className="chart-title">Products Per Category</div>
              {mainCats.length===0?<div style={{color:"var(--t2)",fontSize:11,textAlign:"center",padding:"11px 0"}}>No categories yet</div>:(
                <div className="bar-ch">
                  {mainCats.map(c=>{const ct=prods.filter(p=>(p.category_ids||[]).includes(c.id)).length;const mx=Math.max(...mainCats.map(x=>prods.filter(p=>(p.category_ids||[]).includes(x.id)).length),1);return(
                    <div key={c.id} className="bc-i"><div className="bc-v">{ct}</div><div className="bc-b" style={{height:`${(ct/mx)*100}%`}}/><div className="bc-l">{c.name.slice(0,6)}</div></div>
                  );})}
                </div>
              )}
            </div>
            <div style={{background:"var(--c3)",border:"1px solid var(--glb)",borderRadius:"var(--rsm)",padding:"12px",fontSize:11,color:"var(--t2)",lineHeight:1.9}}>
              <strong style={{color:"var(--g)",display:"block",marginBottom:4,letterSpacing:1}}>GETTING STARTED</strong>
              1. Connect Supabase cloud DB (DB tab)<br/>
              2. Add main categories with thumbnail images (Cats)<br/>
              3. Add sub-categories under each main category (Cats)<br/>
              4. Add products ‚Äî tick multiple categories & sub-cats (Prods)<br/>
              5. Send buy notifications to all users (Notifs)
            </div>
          </>
        )}

        {/* ‚îÄ‚îÄ CATEGORIES ‚îÄ‚îÄ */}
        {tab==="categories"&&(
          <>
            {/* EDIT FORM */}
            {editCat&&(
              <div className="edit-card">
                <div className="edit-title">‚úèÔ∏è Editing ‚Äî {editCat.name}</div>
                <div className="ig">
                  <label className="il">Thumbnail Image</label>
                  {(editCat.image_url||editCat.image)
                    ?<div className="thumb-prev"><img src={editCat.image_url||editCat.image} alt="t"/><button className="thumb-rm" onClick={()=>setEditCat(p=>({...p,image:null,image_url:null}))}>‚úï</button></div>
                    :<ImgZone onChange={e=>handleCatImg(e,setEditCat)}><div style={{fontSize:22,marginBottom:4}}>üñº</div><div style={{fontSize:11,color:"var(--t2)"}}>Tap to upload new thumbnail</div></ImgZone>
                  }
                </div>
                <div className="ig"><label className="il">Name</label><input className="inp" value={editCat.name} onChange={e=>setEditCat(p=>({...p,name:e.target.value}))}/></div>
                <div className="ig"><label className="il">Emoji Icon (fallback)</label><input className="inp" value={editCat.icon||""} onChange={e=>setEditCat(p=>({...p,icon:e.target.value}))}/></div>
                <div className="ig">
                  <label className="il">Parent Category (blank = main category)</label>
                  <select className="inp" value={editCat.parent_id||""} onChange={e=>setEditCat(p=>({...p,parent_id:e.target.value||null}))}>
                    <option value="">‚Äî Make this a Main Category ‚Äî</option>
                    {mainCats.filter(c=>c.id!==editCat.id).map(c=><option key={c.id} value={c.id}>{c.name}</option>)}
                  </select>
                </div>
                <div style={{display:"flex",gap:8}}>
                  <button className="btn btn-g" style={{flex:1}} onClick={saveEditCat}>SAVE CHANGES</button>
                  <button className="btn btn-ol" style={{flex:1,marginTop:0}} onClick={()=>setEditCat(null)}>CANCEL</button>
                </div>
              </div>
            )}

            {/* ADD FORM */}
            {!editCat&&(
              <div className="form-card">
                <div className="form-title">Add Category or Sub-Category</div>
                <div className="ig">
                  <label className="il">Thumbnail Image</label>
                  {newCat.image
                    ?<div className="thumb-prev"><img src={newCat.image} alt="t"/><button className="thumb-rm" onClick={()=>setNewCat(p=>({...p,image:null}))}>‚úï</button></div>
                    :<ImgZone onChange={e=>handleCatImg(e,setNewCat)}><div style={{fontSize:22,marginBottom:4}}>üñº</div><div style={{fontSize:11,color:"var(--t2)"}}>Tap to upload thumbnail</div><div style={{fontSize:9,color:"var(--t2)",marginTop:3}}>Square image ¬∑ JPG/PNG recommended</div></ImgZone>
                  }
                </div>
                <div className="ig"><label className="il">Category Name</label><input className="inp" placeholder="e.g. Looms  or  Handloom Looms" value={newCat.name} onChange={e=>setNewCat(p=>({...p,name:e.target.value}))}/></div>
                <div className="ig"><label className="il">Emoji Icon (shown if no image)</label><input className="inp" placeholder="e.g. ü™°" value={newCat.icon} onChange={e=>setNewCat(p=>({...p,icon:e.target.value}))}/></div>
                <div className="ig">
                  <label className="il">Parent Category ‚Äî leave blank for Main Category</label>
                  <select className="inp" value={newCat.parent_id} onChange={e=>setNewCat(p=>({...p,parent_id:e.target.value}))}>
                    <option value="">‚Äî This is a Main Category ‚Äî</option>
                    {mainCats.map(c=><option key={c.id} value={c.id}>{c.name}</option>)}
                  </select>
                </div>
                <button className="btn btn-g" onClick={addCat}>ADD {newCat.parent_id?"SUB-":""}CATEGORY</button>
              </div>
            )}

            {/* CATEGORY TREE LIST */}
            {mainCats.length===0
              ?<div className="empty"><div className="ei">üè∑</div><div className="et">No categories yet</div><div className="es">Add your first category above.</div></div>
              :mainCats.map(mc=>(
                <div key={mc.id} style={{marginBottom:11}}>
                  <div className="tbl-wrap">
                    {/* MAIN CAT ROW */}
                    <div className="irow" style={{background:"var(--c2)",borderBottom:"1px solid var(--gb)"}}>
                      <div className="ithumb">{mc.image_url?<img src={mc.image_url} alt={mc.name}/>:(mc.icon||"‚óà")}</div>
                      <div className="iinfo">
                        <div className="iname" style={{color:"var(--g)",fontSize:13}}>{mc.name}</div>
                        <div className="isub">{subCatsOf(mc.id).length} sub-cats ¬∑ {prods.filter(p=>(p.category_ids||[]).includes(mc.id)).length} products</div>
                      </div>
                      <div className="iacts">
                        <button className="btn btn-ok btn-sm" onClick={()=>setEditCat({...mc})}>‚úè</button>
                        <button className="btn btn-danger btn-sm" onClick={()=>deleteCat(mc.id)}>‚úï</button>
                      </div>
                    </div>
                    {/* SUB-CAT ROWS */}
                    {subCatsOf(mc.id).map(sc=>(
                      <div key={sc.id} className="irow" style={{paddingLeft:28,borderLeft:"2px solid var(--gb)"}}>
                        <div className="ithumb" style={{width:34,height:34}}>{sc.image_url?<img src={sc.image_url} alt={sc.name}/>:(sc.icon||"‚óà")}</div>
                        <div className="iinfo">
                          <div className="iname" style={{fontSize:11}}>‚Ü≥ {sc.name}</div>
                          <div className="isub">{prods.filter(p=>(p.sub_category_ids||[]).includes(sc.id)).length} products</div>
                        </div>
                        <div className="iacts">
                          <button className="btn btn-ok btn-sm" onClick={()=>setEditCat({...sc})}>‚úè</button>
                          <button className="btn btn-danger btn-sm" onClick={()=>deleteCat(sc.id)}>‚úï</button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              ))
            }
          </>
        )}

        {/* ‚îÄ‚îÄ PRODUCTS ‚îÄ‚îÄ */}
        {tab==="products"&&(
          <>
            <div className="form-card">
              <div className="form-title">Add New Product</div>

              {/* Multi-image upload */}
              <div className="ig">
                <label className="il">Product Images <span style={{color:"var(--t2)",fontWeight:400,letterSpacing:0,fontSize:9}}>(select multiple ¬∑ Amazon-style carousel)</span></label>
                {newProd.images.length>0&&(
                  <div className="img-grid">
                    {newProd.images.map((src,i)=>(
                      <div key={i} className="img-item">
                        <img src={src} alt={`p${i}`}/>
                        {i===0&&<div className="img-mb">MAIN</div>}
                        <button className="img-rm" onClick={()=>setNewProd(p=>({...p,images:p.images.filter((_,j)=>j!==i)}))}>‚úï</button>
                      </div>
                    ))}
                    <div className="img-add"><input type="file" accept="image/*" multiple onChange={handleProdImgs}/><span>+</span></div>
                  </div>
                )}
                {newProd.images.length===0&&(
                  <ImgZone onChange={handleProdImgs} multiple>
                    <div style={{fontSize:24,marginBottom:4}}>üì∑</div>
                    <div style={{fontSize:11,color:"var(--t2)"}}>Tap to upload images</div>
                    <div style={{fontSize:9,color:"var(--t2)",marginTop:3}}>Select multiple ¬∑ First image = main</div>
                  </ImgZone>
                )}
              </div>

              <div className="ig"><label className="il">Product Name</label><input className="inp" placeholder="Full product name" value={newProd.name} onChange={e=>setNewProd(p=>({...p,name:e.target.value}))}/></div>

              {/* Multi-select main categories */}
              <MultiCheck
                items={mainCats}
                selected={newProd.category_ids}
                onToggle={id=>setNewProd(p=>({...p,category_ids:p.category_ids.includes(id)?p.category_ids.filter(x=>x!==id):[...p.category_ids,id]}))}
                label="Main Categories (tick multiple)"
              />

              {/* Multi-select sub-categories ‚Äî only from selected main cats */}
              {newProd.category_ids.length>0&&cats.filter(c=>c.parent_id&&newProd.category_ids.includes(c.parent_id)).length>0&&(
                <MultiCheck
                  items={cats.filter(c=>c.parent_id&&newProd.category_ids.includes(c.parent_id))}
                  selected={newProd.sub_category_ids}
                  onToggle={id=>setNewProd(p=>({...p,sub_category_ids:p.sub_category_ids.includes(id)?p.sub_category_ids.filter(x=>x!==id):[...p.sub_category_ids,id]}))}
                  label="Sub-Categories (tick multiple)"
                />
              )}

              <div className="ig"><label className="il">Emoji Icon (fallback if no image)</label><input className="inp" placeholder="e.g. ü™°" value={newProd.icon} onChange={e=>setNewProd(p=>({...p,icon:e.target.value}))}/></div>
              <div className="ig"><label className="il">Price (‚Çπ)</label><input className="inp" placeholder="Leave blank if Price on Request" inputMode="numeric" value={newProd.price} disabled={newProd.price_on_request} onChange={e=>setNewProd(p=>({...p,price:e.target.value}))}/></div>
              <div className="ig"><Tog on={newProd.price_on_request} onChange={()=>setNewProd(p=>({...p,price_on_request:!p.price_on_request,price:""}))} label="Price on Request (hides price)"/></div>

              {/* ‚îÄ‚îÄ PRODUCT VIDEO ‚îÄ‚îÄ */}
              <div className="ig">
                <label className="il">Product Video <span style={{color:"var(--t2)",fontWeight:400,letterSpacing:0,fontSize:9}}>(optional ¬∑ MP4/MOV ¬∑ max 50MB)</span></label>
                {newProd.video?(
                  <div className="vid-prev">
                    <div className="vid-badge">‚ñ∂ VIDEO</div>
                    <video src={newProd.video} controls playsInline preload="metadata"/>
                    <button className="vid-prev-rm" onClick={()=>setNewProd(p=>({...p,video:null}))}>‚úï</button>
                  </div>
                ):(
                  <div className="vid-zone">
                    <input type="file" accept="video/*" onChange={handleProdVideo}/>
                    <div style={{fontSize:26,marginBottom:5}}>üé¨</div>
                    <div style={{fontSize:11,color:"var(--t2)"}}>Tap to upload product video</div>
                    <div style={{fontSize:9,color:"var(--t2)",marginTop:3}}>MP4, MOV, WebM ¬∑ Max 50MB ¬∑ Shown in product detail</div>
                  </div>
                )}
              </div>

              <div className="ig"><label className="il">Description</label><textarea className="ta" placeholder="Product details, specs, compatibility..." value={newProd.description} onChange={e=>setNewProd(p=>({...p,description:e.target.value}))}/></div>
              <button className="btn btn-g" onClick={addProd}>ADD PRODUCT</button>
            </div>

            {prods.length===0
              ?<div className="empty"><div className="ei">üì¶</div><div className="et">No products yet</div></div>
              :<div className="tbl-wrap">
                {prods.map(p=>(
                  <div key={p.id} className="irow">
                    <div className="ithumb">{(p.images||[])[0]?<img src={p.images[0]} alt={p.name}/>:(p.icon||"üî©")}</div>
                    <div className="iinfo">
                      <div className="iname">{p.name}</div>
                      <div className="isub">
                        {(p.category_ids||[]).map(getCatName).join(", ")||"No cat"} ¬∑ {(p.images||[]).length} img{p.video?<span style={{color:"var(--g)",marginLeft:5}}>¬∑ üé¨ video</span>:null}
                      </div>
                    </div>
                    <div className="iacts">
                      <Tog on={p.price_on_request} onChange={()=>toggleNA(p.id)}/>
                      <button className="btn btn-danger btn-sm" style={{padding:"4px 7px",fontSize:9}} onClick={()=>deleteProd(p.id)}>Del</button>
                    </div>
                  </div>
                ))}
              </div>
            }
          </>
        )}

        {/* ‚îÄ‚îÄ CHATS ‚îÄ‚îÄ */}
        {tab==="chats"&&(
          <>
            {!selChat?(
              <>
                {/* ‚îÄ‚îÄ ADMIN INITIATES NEW CHAT ‚îÄ‚îÄ */}
                <div className="form-card" style={{marginBottom:12}}>
                  <div className="form-title">üì® Message Any User Directly</div>
                  <div style={{display:"flex",gap:8}}>
                    <input className="inp" id="dm-email" style={{flex:1}} placeholder="User email e.g. buyer@gmail.com"/>
                    <button className="btn btn-g btn-sm" style={{flexShrink:0,marginTop:0}} onClick={()=>{
                      const el=document.getElementById("dm-email");
                      const em=(el?.value||"").trim();
                      if(!em||!/\S+@\S+/.test(em)){return;}
                      setSelChat(em); el.value="";
                    }}>OPEN CHAT</button>
                  </div>
                  <div style={{fontSize:9,color:"var(--t2)",marginTop:6,lineHeight:1.6}}>Admin can send text or üéô voice notes to any user ‚Äî they see it in their Enquire tab instantly.</div>
                </div>

                {/* ‚îÄ‚îÄ EXISTING CONVERSATIONS ‚îÄ‚îÄ */}
                {uniqueUsers.length===0
                  ?<div className="empty"><div className="ei">‚úâ</div><div className="et">No conversations yet</div><div className="es">Use the field above to message any user directly.</div></div>
                  :<div className="tbl-wrap">
                    {uniqueUsers.map(email=>{
                      const msgs=chats.filter(m=>m.user_email===email);
                      const locked=!msgs.some(m=>m.locked===false);
                      const last=msgs[msgs.length-1];
                      const hasVoice=last?.msg_type==="voice";
                      return(
                        <div key={email} onClick={()=>setSelChat(email)} style={{padding:"12px 14px",borderBottom:"1px solid var(--glb)",cursor:"pointer",display:"flex",alignItems:"center",gap:10,transition:"background .15s"}}
                          onMouseEnter={e=>e.currentTarget.style.background="var(--c3)"}
                          onMouseLeave={e=>e.currentTarget.style.background="transparent"}>
                          {/* Avatar */}
                          <div style={{width:40,height:40,borderRadius:"50%",background:"var(--gl)",border:"1.5px solid var(--gb)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:16,flexShrink:0}}>üë§</div>
                          {/* Info */}
                          <div style={{flex:1,minWidth:0}}>
                            <div style={{fontSize:12,color:"var(--t1)",fontWeight:700}}>{email.split("@")[0]}</div>
                            <div style={{fontSize:9,color:"var(--t2)",marginTop:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>
                              {last?(hasVoice?"üéô Voice note":last.message):"No messages yet"}
                            </div>
                          </div>
                          {/* Status */}
                          <div style={{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:4,flexShrink:0}}>
                            <span className={`pill ${locked?"pill-y":"pill-g"}`}>{locked?"LOCKED":"OPEN"}</span>
                            <div style={{fontSize:9,color:"var(--t2)"}}>{msgs.length} msg{msgs.length!==1?"s":""}</div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                }
              </>
            ):(
              /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ OPEN CHAT WINDOW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
              <div style={{display:"flex",flexDirection:"column"}}>
                {/* Chat header */}
                <div style={{display:"flex",alignItems:"center",gap:9,paddingBottom:11,borderBottom:"1px solid var(--glb)",marginBottom:11}}>
                  <button className="btn btn-ol btn-sm" style={{width:"auto",padding:"5px 10px",marginTop:0,flexShrink:0}} onClick={()=>setSelChat(null)}>‚Äπ Back</button>
                  <div style={{width:34,height:34,borderRadius:"50%",background:"var(--gl)",border:"1.5px solid var(--gb)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:15,flexShrink:0}}>üë§</div>
                  <div style={{flex:1,minWidth:0}}>
                    <div style={{fontSize:12,color:"var(--t1)",fontWeight:700,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{selChat}</div>
                    <div style={{fontSize:9,color:chats.some(m=>m.user_email===selChat&&m.locked===false)?"#3ecf7a":"var(--g)"}}>
                      {chats.some(m=>m.user_email===selChat&&m.locked===false)?"üîì Chat open ‚Äî user can reply":"üîí Locked ‚Äî user cannot reply yet"}
                    </div>
                  </div>
                  {!chats.some(m=>m.user_email===selChat&&m.locked===false)&&(
                    <button className="btn btn-g btn-sm" style={{flexShrink:0,marginTop:0}} onClick={()=>grantChat(selChat)}>Unlock</button>
                  )}
                </div>

                {/* Messages scroll area */}
                <div style={{minHeight:180,maxHeight:320,overflowY:"auto",display:"flex",flexDirection:"column",gap:9,marginBottom:100,padding:"2px 0"}}>
                  {chats.filter(m=>m.user_email===selChat).length===0&&(
                    <div className="empty" style={{padding:"28px 0"}}>
                      <div className="ei" style={{fontSize:28}}>‚úâ</div>
                      <div className="es">No messages yet.<br/>Send a text or voice note below.</div>
                    </div>
                  )}
                  {chats.filter(m=>m.user_email===selChat).map(m=>{
                    const isAdmin=m.from_role==="admin";
                    const isVoice=m.msg_type==="voice";
                    const side=isAdmin?"u":"a";
                    return(
                      <div key={m.id} style={{display:"flex",flexDirection:"column",alignItems:isAdmin?"flex-end":"flex-start",gap:2}}>
                        {isVoice
                          ?<VoiceNote msg={m} side={side}/>
                          :<div style={{maxWidth:"80%",padding:"9px 12px",borderRadius:isAdmin?"11px 11px 3px 11px":"11px 11px 11px 3px",fontSize:12,
                            background:isAdmin?"var(--gl)":"var(--glass)",
                            border:`1px solid ${isAdmin?"var(--gb)":"var(--glb)"}`,color:"var(--t1)",lineHeight:1.5}}>{m.message}</div>
                        }
                        <div style={{fontSize:9,color:"var(--t2)",display:"flex",alignItems:"center",gap:4}}>
                          <span>{m.sent_at}</span>
                          <span style={{color:isAdmin?"var(--g)":"var(--t2)"}}>¬∑ {isAdmin?"You (Admin)":selChat.split("@")[0]}</span>
                          {isVoice&&<span style={{color:"var(--t2)"}}>¬∑ üéô</span>}
                        </div>
                      </div>
                    );
                  })}
                </div>

                {/* ChatInputBar pinned at bottom ‚Äî admin can send text or voice */}
                <div style={{position:"sticky",bottom:0,marginTop:"auto"}}>
                  <ChatInputBar
                    onSendText={async txt=>{
                      const m={id:uid(),user_email:selChat,from_role:"admin",message:txt,msg_type:"text",locked:false,sent_at:nowIST()};
                      setChats(p=>[...p,m]); await DB.addChat(m); notify("Message sent to "+selChat.split("@")[0]);
                    }}
                    onSendVoice={async(audioData,duration)=>{
                      const m={id:uid(),user_email:selChat,from_role:"admin",message:"üéô Voice note",msg_type:"voice",voice_data:audioData,voice_duration:duration,locked:false,sent_at:nowIST()};
                      setChats(p=>[...p,m]); await DB.addChat(m); notify("Voice note sent to "+selChat.split("@")[0]);
                    }}
                  />
                </div>
              </div>
            )}
          </>
        )}

        {/* ‚îÄ‚îÄ USER ACTIVITY ‚îÄ‚îÄ */}
        {tab==="activity"&&(
          <>
            <div style={{marginBottom:11,display:"flex",justifyContent:"space-between"}}>
              <div style={{fontSize:10,color:"var(--t2)",letterSpacing:1}}>{userActivity.length} users ¬∑ IST timestamps</div>
              <div style={{fontSize:10,color:sbOn?"#3ecf7a":"var(--t2)"}}>{sbOn?"Live from Supabase":"Local data"}</div>
            </div>
            {userActivity.length===0
              ?<div className="empty"><div className="ei">üëÅ</div><div className="et">No activity yet</div><div className="es">User logins and product views appear here with IP addresses.</div></div>
              :userActivity.map((u,i)=>(
                <div key={i} className="tbl-wrap" style={{marginBottom:10}}>
                  <div style={{padding:"9px 13px",background:"var(--c2)",borderBottom:"1px solid var(--gb)"}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
                      <div><div style={{fontSize:12,color:"var(--g)",fontWeight:700}}>{u.name}</div><div style={{fontSize:9,color:"var(--t2)"}}>{u.email}</div></div>
                      <div style={{fontSize:10,color:"var(--t2)"}}>{u.events.length} events</div>
                    </div>
                  </div>
                  {u.events.slice(0,6).map((ev,j)=>(
                    <div key={j} className="act-row">
                      <div className="act-meta"><div className="act-name">{ev.action}</div><div className="act-time">{ev.time}</div></div>
                      <div className="act-ip">üåê {ev.ip}</div>
                    </div>
                  ))}
                  {u.events.length>6&&<div style={{padding:"7px 13px",fontSize:9,color:"var(--t2)"}}>+{u.events.length-6} more events</div>}
                </div>
              ))
            }
          </>
        )}

        {/* ‚îÄ‚îÄ NOTIFICATIONS ‚îÄ‚îÄ */}
        {tab==="notifs"&&(
          <>
            <div className="form-card">
              <div className="form-title">Send Notification to All Users</div>
              <div className="ig"><label className="il">Title</label><input className="inp" placeholder="e.g. New Stock Available!" value={newNotif.title} onChange={e=>setNewNotif(p=>({...p,title:e.target.value}))}/></div>
              <div className="ig"><label className="il">Message</label><textarea className="ta" placeholder="Write your message to all users..." value={newNotif.message} onChange={e=>setNewNotif(p=>({...p,message:e.target.value}))}/></div>
              <button className="btn btn-g" onClick={sendNotif}>üîî SEND TO ALL USERS</button>
            </div>
            {notifs.length===0
              ?<div className="empty"><div className="ei">üîî</div><div className="et">No notifications sent</div></div>
              :<div className="tbl-wrap">
                {notifs.map(n=>(
                  <div key={n.id} style={{padding:"11px 13px",borderBottom:"1px solid var(--glb)"}}>
                    <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:8}}>
                      <div style={{flex:1}}>
                        <div style={{fontSize:12,color:"var(--t1)",fontWeight:700,marginBottom:2}}>{n.title}</div>
                        <div style={{fontSize:11,color:"var(--t2)",lineHeight:1.5}}>{n.message}</div>
                        <div style={{fontSize:9,color:"var(--g)",marginTop:3}}>{n.created_at}</div>
                      </div>
                      <button className="btn btn-danger btn-sm" style={{padding:"4px 8px",fontSize:9,flexShrink:0}} onClick={async()=>{await DB.delNotif(n.id);setNotifs(p=>p.filter(x=>x.id!==n.id));notify("Deleted");}}>Del</button>
                    </div>
                  </div>
                ))}
              </div>
            }
          </>
        )}

        {/* ‚îÄ‚îÄ üßπ STORAGE CLEANUP ‚îÄ‚îÄ */}
        {tab==="cleanup"&&(()=>{
          const CLEANUP_TYPES=[
            {id:"chats",   label:"Chat Messages",       icon:"‚úâ",  sub:"All user & admin messages including voice notes",    count:chats.length},
            {id:"audit",   label:"Audit Logs",          icon:"üìã", sub:"Login events and product view logs",                 count:audit.length},
            {id:"views",   label:"View History",        icon:"üëÅ",  sub:"Product view tracking & recommendation data",       count:views.length},
            {id:"notifr",  label:"Notification Reads",  icon:"üîî", sub:"Read receipts for user notifications",              count:0},
            {id:"notifs",  label:"Notifications",       icon:"üì¢", sub:"Broadcast notifications sent to users",             count:notifs.length},
          ];
          const toggle=id=>setClSel(p=>p.includes(id)?p.filter(x=>x!==id):[...p,id]);
          const allSel=CLEANUP_TYPES.every(t=>clSel.includes(t.id));
          const totalRec=CLEANUP_TYPES.filter(t=>clSel.includes(t.id)).reduce((a,t)=>a+(t.count||0),0);

          const runCleanup=async()=>{
            if(!clSel.length){notify("Select at least one data type");return;}
            if(!clTo){notify("Set an end date for deletion");return;}
            setClRunning(true);setClProgress(0);setClDone(null);
            const before=new Date(clTo+"T23:59:59").toISOString();
            const steps=clSel.length;
            let done=0;
            try{
              if(clSel.includes("chats")){    await DB.bulkDeleteChats(before);    setChats(p=>p.filter(m=>(m.sent_at||"")>before));  done++; setClProgress(Math.round(done/steps*100));}
              if(clSel.includes("audit")){    await DB.bulkDeleteAudit(before);    setAudit(p=>p.filter(a=>(a.logged_at||"")>before)); done++; setClProgress(Math.round(done/steps*100));}
              if(clSel.includes("views")){    await DB.bulkDeleteViews(before);    setViews(p=>p.filter(v=>(v.viewed_at||"")>before)); done++; setClProgress(Math.round(done/steps*100));}
              if(clSel.includes("notifr")){   await DB.bulkDeleteNotifReads(before);                                                    done++; setClProgress(Math.round(done/steps*100));}
              if(clSel.includes("notifs")){   await DB.bulkDeleteNotifs(before);   setNotifs(p=>p.filter(n=>(n.created_at||"")>before));done++; setClProgress(Math.round(done/steps*100));}
              setClDone({ok:true,msg:`Deleted data before ${clTo} from ${clSel.length} table(s)${sbOn?" in Supabase":""}.`});
              setClSel([]); setClConfirm(false); setClFrom(""); setClTo("");
            }catch(e){
              setClDone({ok:false,msg:"Error: "+e.message});
            }
            setClRunning(false);setClProgress(0);
          };

          return(
            <>
              {/* Header info */}
              <div style={{background:"rgba(176,48,48,.08)",border:"1px solid rgba(176,48,48,.2)",borderRadius:"var(--rsm)",padding:"12px 14px",marginBottom:13}}>
                <div style={{fontSize:12,fontWeight:700,color:"#e05555",marginBottom:4}}>üßπ Storage Cleanup Manager</div>
                <div style={{fontSize:10,color:"var(--t2)",lineHeight:1.7}}>
                  Select a date range and the data types you want to permanently delete.<br/>
                  All records <strong style={{color:"var(--t1)"}}>before your chosen end date</strong> will be removed{sbOn?" from Supabase cloud":""}.
                </div>
              </div>

              {/* Result banner */}
              {clDone&&(
                <div style={{background:clDone.ok?"rgba(30,122,70,.15)":"rgba(176,48,48,.12)",border:`1px solid ${clDone.ok?"rgba(30,122,70,.3)":"rgba(176,48,48,.3)"}`,borderRadius:"var(--rsm)",padding:"11px 13px",marginBottom:12}}>
                  <div style={{fontSize:11,color:clDone.ok?"#3ecf7a":"#e05555",fontWeight:700}}>{clDone.ok?"‚úì Cleanup complete":"‚úó Error"}</div>
                  <div style={{fontSize:10,color:"var(--t2)",marginTop:3}}>{clDone.msg}</div>
                  <button className="btn btn-ol btn-sm" style={{marginTop:9}} onClick={()=>setClDone(null)}>Dismiss</button>
                </div>
              )}

              {/* DATE RANGE */}
              <div className="cl-section">
                <div className="cl-title">üìÖ Date Range</div>
                <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10}}>
                  <div className="ig" style={{marginBottom:0}}>
                    <label className="il">From (optional)</label>
                    <input className="inp" type="date" value={clFrom} onChange={e=>setClFrom(e.target.value)} style={{fontSize:12}}/>
                  </div>
                  <div className="ig" style={{marginBottom:0}}>
                    <label className="il">Delete Before ‚òÖ</label>
                    <input className="inp" type="date" value={clTo} onChange={e=>setClTo(e.target.value)} style={{fontSize:12}}/>
                  </div>
                </div>
                {clTo&&<div style={{marginTop:9,fontSize:10,color:"var(--t2)",lineHeight:1.6}}>Will delete records with dates <strong style={{color:"#e05555"}}>on or before {clTo}</strong></div>}
                {/* Quick presets */}
                <div style={{display:"flex",gap:6,flexWrap:"wrap",marginTop:10}}>
                  {[["Last 30 days",30],["Last 3 months",90],["Last 6 months",180],["Last 1 year",365]].map(([lbl,days])=>(
                    <button key={lbl} className="btn btn-ol btn-sm" style={{marginTop:0,fontSize:9,padding:"5px 9px"}} onClick={()=>{
                      const d=new Date(); d.setDate(d.getDate()-days);
                      setClTo(d.toISOString().slice(0,10));
                    }}>{lbl}</button>
                  ))}
                </div>
              </div>

              {/* DATA TYPE CHECKBOXES */}
              <div className="cl-section">
                <div className="cl-title">
                  üì¶ Select Data to Delete
                  <span style={{marginLeft:"auto",fontSize:9,color:"var(--t2)",cursor:"pointer",fontWeight:400,letterSpacing:0}} onClick={()=>setClSel(allSel?[]:CLEANUP_TYPES.map(t=>t.id))}>
                    {allSel?"Deselect all":"Select all"}
                  </span>
                </div>
                {CLEANUP_TYPES.map(t=>{
                  const on=clSel.includes(t.id);
                  return(
                    <div key={t.id} className="cl-item" onClick={()=>toggle(t.id)}>
                      <div className={`cl-chk ${on?"on":""}`}>{on?"‚úì":""}</div>
                      <div className="cl-label">
                        <div className="cl-label-name">{t.icon} {t.label}</div>
                        <div className="cl-label-sub">{t.sub}</div>
                      </div>
                      <div className="cl-count">{t.count}</div>
                    </div>
                  );
                })}
              </div>

              {/* SUMMARY + CONFIRM */}
              {clSel.length>0&&clTo&&!clConfirm&&(
                <div style={{background:"var(--c3)",border:"1px solid var(--glb)",borderRadius:"var(--rsm)",padding:"13px",marginBottom:12}}>
                  <div style={{fontSize:11,color:"var(--t1)",fontWeight:700,marginBottom:5}}>Ready to delete:</div>
                  <div style={{fontSize:10,color:"var(--t2)",lineHeight:1.8}}>
                    ‚Ä¢ Data types: <strong style={{color:"var(--t1)"}}>{clSel.map(id=>CLEANUP_TYPES.find(t=>t.id===id)?.label).join(", ")}</strong><br/>
                    ‚Ä¢ Records before: <strong style={{color:"#e05555"}}>{clTo}</strong><br/>
                    ‚Ä¢ Approx. records affected: <strong style={{color:"var(--g)"}}>{totalRec}</strong><br/>
                    ‚Ä¢ Storage: <strong style={{color:"var(--t1)"}}>{sbOn?"Supabase Cloud":"Local Storage"}</strong>
                  </div>
                  <button className="btn btn-danger" style={{marginTop:11}} onClick={()=>setClConfirm(true)}>üóë REVIEW & CONFIRM DELETE</button>
                </div>
              )}

              {/* FINAL CONFIRM */}
              {clConfirm&&(
                <div className="cl-confirm">
                  <div className="cl-confirm-title">‚ö†Ô∏è PERMANENT DELETION ‚Äî CANNOT BE UNDONE</div>
                  <div className="cl-confirm-body">
                    You are about to permanently delete <strong>{totalRec} records</strong> across <strong>{clSel.length} table(s)</strong> from <strong>{sbOn?"Supabase":"local storage"}</strong> dated on or before <strong>{clTo}</strong>.<br/><br/>
                    This cannot be reversed. Make sure you have taken a backup if needed.
                  </div>
                  {clRunning?(
                    <>
                      <div style={{fontSize:10,color:"var(--t2)",marginBottom:6}}>Deleting‚Ä¶ {clProgress}% complete</div>
                      <div className="progress-bar"><div className="progress-fill" style={{width:clProgress+"%"}}/></div>
                    </>
                  ):(
                    <div style={{display:"flex",gap:8}}>
                      <button className="btn btn-danger" style={{flex:1}} onClick={runCleanup}>YES, DELETE PERMANENTLY</button>
                      <button className="btn btn-ol" style={{flex:1,marginTop:0}} onClick={()=>setClConfirm(false)}>CANCEL</button>
                    </div>
                  )}
                </div>
              )}

              {/* TIPS */}
              <div style={{background:"var(--c3)",border:"1px solid var(--glb)",borderRadius:"var(--rsm)",padding:"12px 13px",fontSize:10,color:"var(--t2)",lineHeight:1.9}}>
                <strong style={{color:"var(--g)",display:"block",marginBottom:4}}>üí° STORAGE TIPS</strong>
                Chat messages with voice notes take the most space (audio stored as base64).<br/>
                View history & audit logs grow fastest ‚Äî clean monthly.<br/>
                {sbOn?"Supabase free tier: 500MB DB + 1GB Storage.":"Switch to Supabase for larger storage limits."}
              </div>
            </>
          );
        })()}

        {/* ‚îÄ‚îÄ SUPABASE DB SETUP ‚îÄ‚îÄ */}
        {tab==="supabase"&&(()=>{
          const [showKey,setShowKey]=useState(false);
          return(
          <>
            {/* STATUS BANNER */}
            <div style={{padding:"13px 14px",borderRadius:"var(--rsm)",marginBottom:13,
              background:sbOn?"rgba(30,122,70,.15)":"rgba(176,48,48,.08)",
              border:"1px solid "+(sbOn?"rgba(30,122,70,.3)":"rgba(176,48,48,.25)")}}>
              <div style={{fontSize:13,fontWeight:700,color:sbOn?"#3ecf7a":"#e05555",marginBottom:4,display:"flex",alignItems:"center",gap:8}}>
                <span style={{fontSize:18}}>{sbOn?"‚òÅ":"üì±"}</span>
                {sbOn?"Supabase Connected ‚Äî Cloud Active":"Not Connected ‚Äî Using Local Storage"}
              </div>
              <div style={{fontSize:10,color:"var(--t2)",lineHeight:1.7}}>
                {sbOn
                  ?"All products, categories, chats and user data sync to Supabase cloud. Images and videos hosted on CDN."
                  :"Data saves on this device only. Connect Supabase to sync across all devices and enable image hosting."}
              </div>
            </div>

            {/* STEP-BY-STEP GUIDE (only when not connected) */}
            {!sbOn&&(
              <div style={{background:"rgba(212,175,55,.05)",border:"1px solid var(--gb)",borderRadius:"var(--rsm)",padding:"14px",marginBottom:13}}>
                <div style={{fontSize:9,color:"var(--g)",letterSpacing:3,fontWeight:700,textTransform:"uppercase",marginBottom:11}}>How to Get Your Keys</div>
                {[
                  ["1","Go to","supabase.com","‚Üí Sign up free ‚Üí New Project"],
                  ["2","Wait ~2 min ‚Üí Go to","Settings ‚Üí API",""],
                  ["3","Copy your","Project URL","(starts with https://)"],
                  ["4","Copy the","anon public key","(starts with eyJ...)"],
                  ["5","Paste both below ‚Üí","Test & Connect","‚Äî done! ‚úì"],
                ].map(([n,a,b,c])=>(
                  <div key={n} style={{display:"flex",gap:10,marginBottom:9,alignItems:"flex-start"}}>
                    <div style={{width:22,height:22,borderRadius:"50%",background:"var(--gl)",border:"1px solid var(--gb)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:10,fontWeight:700,color:"var(--g)",flexShrink:0}}>{n}</div>
                    <div style={{fontSize:11,color:"var(--t2)",lineHeight:1.6,paddingTop:2}}>{a} <strong style={{color:"var(--t1)"}}>{b}</strong> {c}</div>
                  </div>
                ))}
              </div>
            )}

            {/* CONNECTION FORM */}
            <div className="form-card">
              <div className="form-title">{sbOn?"üîó Connected Database":"üîå Connect Supabase Database"}</div>

              <div className="ig">
                <label className="il">Project URL</label>
                <input className="inp" placeholder="https://xxxxx.supabase.co"
                  value={sbCfg.url} onChange={e=>setSbCfg(p=>({...p,url:e.target.value}))}
                  autoCapitalize="none" autoCorrect="off" spellCheck={false}
                  style={{fontFamily:"monospace",fontSize:12}}/>
                <div style={{fontSize:9,color:"var(--t2)",marginTop:4}}>Supabase ‚Üí Settings ‚Üí API ‚Üí Project URL</div>
              </div>

              <div className="ig">
                <label className="il">Anon / Public Key</label>
                <div className="iw">
                  <input className="inp" type={showKey?"text":"password"}
                    placeholder="eyJhbGciOiJIUzI1NiIs..."
                    value={sbCfg.key} onChange={e=>setSbCfg(p=>({...p,key:e.target.value}))}
                    autoCapitalize="none" autoCorrect="off" spellCheck={false}
                    style={{fontFamily:"monospace",fontSize:11}}/>
                  <button className="ieye" onClick={()=>setShowKey(v=>!v)}>{showKey?"üôà":"üëÅ"}</button>
                </div>
                <div style={{fontSize:9,color:"var(--t2)",marginTop:4}}>Supabase ‚Üí Settings ‚Üí API ‚Üí anon public key</div>
              </div>

              {!sbOn
                ?<button className="btn btn-g" onClick={connectSB} style={{letterSpacing:2}}>‚ö° TEST &amp; CONNECT</button>
                :<div style={{display:"flex",gap:8}}>
                  <button className="btn btn-g" style={{flex:1}} onClick={connectSB}>‚Ü∫ RECONNECT</button>
                  <button className="btn btn-danger" style={{flex:1,marginTop:0}} onClick={disconnectSB}>DISCONNECT</button>
                </div>
              }
            </div>

            {/* SQL SCHEMA */}
            <div className="form-card">
              <div className="form-title">SQL Schema ‚Äî Run This First in Supabase</div>
              <div style={{fontSize:10,color:"var(--t2)",marginBottom:9,lineHeight:1.7}}>
                In Supabase ‚Üí <strong style={{color:"var(--t1)"}}>SQL Editor</strong> ‚Üí New query ‚Üí paste this ‚Üí Run.<br/>
                Also create a Storage bucket named <strong style={{color:"var(--g)"}}>sms-images</strong> and make it <strong style={{color:"var(--t1)"}}>Public</strong>.
              </div>
              <div className="sb-schema">{SCHEMA}</div>
              <button className="btn btn-ol" style={{marginTop:0,fontSize:10,letterSpacing:2}}
                onClick={()=>{navigator.clipboard?.writeText(SCHEMA).then(()=>notify("SQL schema copied!")).catch(()=>notify("Long-press schema to copy"));}}>
                üìã COPY SQL SCHEMA
              </button>
            </div>

            {/* FEATURES LIST */}
            <div className="form-card">
              <div className="form-title">What Supabase Unlocks</div>
              {[
                ["‚òÅ","Cloud Sync","Data across all devices & admins"],
                ["üì∑","Image & Video Hosting","CDN-served media, no size limits"],
                ["üåê","IP Address Logging","Real user IPs per login & view"],
                ["üìä","Live Analytics","Real-time view history & audit"],
                ["üîî","Notification Tracking","Per-user read receipts"],
                ["üîí","Multi-Device Admin","Same Supabase = same data everywhere"],
              ].map(([ic,title,desc],i)=>(
                <div key={i} className="sec-row">
                  <div className="sl">
                    <strong style={{color:"var(--t1)"}}>{ic} {title}</strong>
                    <div style={{fontSize:9,color:"var(--t2)",marginTop:2}}>{desc}</div>
                  </div>
                  <span style={{fontSize:11,color:sbOn?"#3ecf7a":"var(--t2)",fontWeight:700}}>{sbOn?"‚úì":""}</span>
                </div>
              ))}
            </div>
          </>
          );
        })()}

      </div>

      <div className="bnav">
        {adminNavs.map(n=>(
          <div key={n.id} className={`bn ${tab===n.id?"on":""}`} onClick={()=>setTab(n.id)}>
            <div className="bn-i">{n.icon}</div>
            <div className="bn-l">{n.label}</div>
          </div>
        ))}
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ROOT APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function App(){
  const [screen,setScreen]=useState("loading");
  const [user,setUser]=useState(null);
  const [ip,setIp]=useState("‚Äî");

  useEffect(()=>{
    (async()=>{
      // Get IP quietly in background
      getIP().then(setIp);

      // Load Supabase config if saved
      const cfg=await LS.get(KEY_SB);
      if(cfg?.url&&cfg?.key){
        try{ _sb=new SB(cfg.url,cfg.key); }catch(e){ console.warn("SB init failed",e); }
      }

      // Check for saved session (Stay Logged In)
      const sess=await LS.get(KEY_SESSION);
      if(sess?.role){
        // Session exists ‚Äî skip splash & auth, go straight in
        if(sess.role==="admin"){
          setScreen("admin");
        } else if(sess.role==="user" && sess.user){
          setUser(sess.user);
          setScreen("user");
        } else {
          setScreen("splash");
        }
      } else {
        setScreen("splash");
      }
    })();
  },[]);

  const handleLogout=async()=>{
    await LS.del(KEY_SESSION); // clear saved session on logout
    setUser(null);
    setScreen("splash");
  };

  if(screen==="loading") return(
    <div style={{position:"fixed",inset:0,background:"var(--c)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:16}}>
      <div style={{fontFamily:"'Bebas Neue',sans-serif",fontSize:28,color:"var(--g)",letterSpacing:5}}>SURESH MILLGIN</div>
      <div style={{width:120,height:2,background:"var(--c4)",overflow:"hidden",borderRadius:1}}>
        <div style={{height:"100%",background:"var(--g)",animation:"bs 1s ease-in-out infinite"}}/>
      </div>
      <div style={{fontSize:9,color:"var(--t2)",letterSpacing:3,textTransform:"uppercase"}}>Loading‚Ä¶</div>
    </div>
  );

  return (
    <>
      {screen==="splash"&&<Splash onAccept={()=>setScreen("auth")}/>}
      {screen==="auth"&&<Auth
        onUserLogin={u=>{setUser(u);setScreen("user");}}
        onAdminLogin={()=>setScreen("admin")}
      />}
      {screen==="user"&&<UserApp user={user} ip={ip} onLogout={handleLogout}/>}
      {screen==="admin"&&<AdminApp onLogout={handleLogout}/>}
    </>
  );
}


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INJECT CSS + RENDER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
(function(){
  const style=document.createElement("style");
  style.textContent=CSS;
  document.head.appendChild(style);
})();

const root=ReactDOM.createRoot(document.getElementById("root"));
root.render(React.createElement(App));
</script>
</body>
</html>
